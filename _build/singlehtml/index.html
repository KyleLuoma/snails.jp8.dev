<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SNAILS 2025 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=233393fd"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="about-snails">
<h1>About SNAILS<a class="headerlink" href="#about-snails" title="Link to this heading">¶</a></h1>
<section id="what-is-snails">
<h2>What is SNAILS?<a class="headerlink" href="#what-is-snails" title="Link to this heading">¶</a></h2>
<p>SNAILS is a set of NL-to-SQL-related artifacts designed to explore the effects of schema naming on LLM-based NL-to-SQL performance. It includes a set of real-world databases and associated natural language (NL) : SQL gold query pairs, human-labeled data containing naturalness classifications the tables and columns in the database collection, a model and method for ML-based naturalness classification, and prompting strategies for improving schema identifier naturalness.</p>
<img alt="_images/nat_view.png" src="_images/nat_view.png" />
</section>
<section id="access-snails-artifacts">
<h2>Access SNAILS Artifacts<a class="headerlink" href="#access-snails-artifacts" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://www.github.com/kyleluoma/SNAILS">SNAILS Artifacts on GitHub</a></p>
<p><a class="reference external" href="https://huggingface.co/kyleluoma/SNAILS-word-naturalness-classifier">SNAILS Word Naturalness Classifier on HuggingFace</a></p>
<p><a class="reference external" href="https://adalabucsd.github.io/papers/TR_2025_SNAILS.pdf">SNAILS Technical Report</a></p>
</section>
<section id="what-snails-isn-t">
<h2>What SNAILS Isn’t:<a class="headerlink" href="#what-snails-isn-t" title="Link to this heading">¶</a></h2>
<p>SNAILS is not a fully-featured benchmark similar to Spider or BIRD that maintains a leaderboard, and provides a training, and dev dataset while also retaining a hidden test set. Instead SNAILS artifacts are a starting point for further research into schema-specific effects on NL-to-SQL. It can also be used to support the development of new NL-to-SQL methods. We encourage other researchers and developers to use our artifacts for their research objectives, and invite collaboration and feedback from the community.</p>
</section>
<section id="contact-first-author">
<h2>Contact First Author<a class="headerlink" href="#contact-first-author" title="Link to this heading">¶</a></h2>
<p>Email: <a class="reference external" href="mailto:kluoma&#37;&#52;&#48;ucsd&#46;edu">kluoma<span>&#64;</span>ucsd<span>&#46;</span>edu</a></p>
<div class="toctree-wrapper compound">
<span id="document-usage/installation"></span><section id="installing-snails">
<span id="installing"></span><h3>Installing SNAILS<a class="headerlink" href="#installing-snails" title="Link to this heading">¶</a></h3>
<p>Understanding that SNAILS is a collection of artifacts and example implementations of natural
views and other concepts, installation isn’t a monolithic process with a defined path to
system start. Instead, we offer steps here to retrieve the SNAILS artifacts and install dependencies.</p>
<p>Start by <strong>cloning the repository</strong> and installing dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">kyleluoma</span><span class="o">/</span><span class="n">SNAILS</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">venv</span>
<span class="n">venv</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">activate</span> <span class="o">&lt;</span><span class="ow">or</span><span class="o">&gt;</span> <span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p><strong>PyTorch is required</strong>
but we don’t include it in requirements.txt. This is so that
you can <a class="reference external" href="https://pytorch.org/get-started/locally/">acquire the appropriate configuration</a> for your own environment.</p>
<p><strong>Install the SNAILS database instances</strong> by following the steps in <a class="reference internal" href="#databases"><span class="std std-ref">SNAILS databases</span></a></p>
<p><strong>Add your own API keys</strong> to the following files in .local_example and move to the .local folder:</p>
<ul class="simple">
<li><p>openai.json - Required for GPT 3.5 and GPT 4o SQL inference and schema renaming</p></li>
<li><p>vertex.json - Required for Gemini 1.5 pro SQL inference</p></li>
<li><p>huggingface.json - Required for retrieving the schema naturalness classifier</p></li>
</ul>
<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-artifacts/artifacts"></span><section id="snails-artifacts">
<h3>SNAILS artifacts<a class="headerlink" href="#snails-artifacts" title="Link to this heading">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-artifacts/databases"></span><section id="snails-databases">
<span id="databases"></span><h4>SNAILS databases<a class="headerlink" href="#snails-databases" title="Link to this heading">¶</a></h4>
<p>The SNAILS database collection is drawn from a variety of sources (<a class="reference internal" href="#database-sources"><span class="std std-ref">Database Sources</span></a>).</p>
<p>Installation instructions (<a class="reference internal" href="#installing-databases"><span class="std std-ref">Database Installation</span></a>) will guide you through downloading and instantiating the MS SQL database backup files.</p>
<div class="toctree-wrapper compound">
<span id="document-artifacts/databases/database_sources"></span><section id="database-sources">
<span id="id1"></span><h5>Database Sources<a class="headerlink" href="#database-sources" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p><strong>NPS IRMA Portal</strong> <a class="reference external" href="https://irma.nps.gov/Portal/">https://irma.nps.gov/Portal/</a>. Accessed: April 2023.</p></li>
<li><p><strong>ASIS_20161108_HerpInv_Database</strong> Robert Cook. 2016. Field Data for Assateague Island National Seashore Amphibian and Reptile Inventory. <a class="reference external" href="https://irma.nps.gov/DataStore/Reference/Profile/2236826">https://irma.nps.gov/DataStore/Reference/Profile/2236826</a>. Accessed: April 2023.</p></li>
<li><p><strong>ATBI</strong> Thomas Evans. 2015. Great Smoky Mountains All Taxa Biodiversity Inventory (ATBI) Plot Vegetation Monitoring Database. <a class="reference external" href="https://irma.nps.gov/DataStore/Reference/Profile/2221324">https://irma.nps.gov/DataStore/Reference/Profile/2221324</a>. Accessed: April 2023</p></li>
<li><p><strong>KlamathInvasiveSpecies</strong> Klamath Inventory and Monitoring Network. 2021. Exotic and Invasive Plants Monitoring Database. <a class="reference external" href="https://irma.nps.gov/DataStore/Reference/Profile/2288667">https://irma.nps.gov/DataStore/Reference/Profile/2288667</a>. Accessed: April 2023.</p></li>
<li><p><strong>PacificIslandLandbirds</strong> Seth Judge and Kevin Kozar. 2023. Pacific Island Network Landbird Monitoring Dataset. <a class="reference external" href="https://irma.nps.gov/DataStore/Reference/Profile/2300107">https://irma.nps.gov/DataStore/Reference/Profile/2300107</a>. <a class="reference external" href="https://doi.org/10.57830/2300107">https://doi.org/10.57830/2300107</a> Accessed: April 2023.</p></li>
<li><p><strong>CratersWildlifeObservations</strong> Charles Stefanic. 2021. Wildlife Observations Database: Craters of the Moon National Monument and Preserve 1921-2021. <a class="reference external" href="https://irma.nps.gov/DataStore/Reference/Profile/2192964">https://irma.nps.gov/DataStore/Reference/Profile/2192964</a>. Accessed: April 2023.</p></li>
<li><p><strong>NorthernPlainsFireManagement</strong> Ian Muirhead. 2021. Northern Great Plains Fire Management: FFI Database. <a class="reference external" href="https://irma.nps.gov/DataStore/Reference/Profile/2297267">https://irma.nps.gov/DataStore/Reference/Profile/2297267</a>. Accessed: April 2023.</p></li>
<li><p><strong>NTSB</strong> National Center for Statistics and Analysis. 2022. Overview of the 2021 Crash Investigation Sampling System. <a class="reference external" href="https://crashstats.nhtsa.dot.gov/Api/Public/ViewPublication/813397">https://crashstats.nhtsa.dot.gov/Api/Public/ViewPublication/813397</a> Traffic Safety Facts Research Note. Report No. DOT HS 813 397.</p></li>
<li><p><strong>NYSED_SRC2022</strong> Report Card Database 2021-22. <a class="reference external" href="https://data.nysed.gov/files/essa/21-22/SRC2022.zip">https://data.nysed.gov/files/essa/21-22/SRC2022.zip</a>. Accessed: May 2023.</p></li>
<li><p><strong>SBODemoUS</strong> Marie-Laurence Poujois. 2021. Localized Demo Databases Now Available for SAP Business One 10.0 FP 2011. <a class="reference external" href="https://blogs.sap.com/2021/01/29/localized-demo-databases-now-available-for-sap-business-one-10.0-fp-2011/">https://blogs.sap.com/2021/01/29/localized-demo-databases-now-available-for-sap-business-one-10.0-fp-2011/</a>. Accessed: April 2023</p></li>
</ul>
<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-artifacts/databases/installing_databases"></span><section id="database-installation">
<span id="installing-databases"></span><h5>Database Installation<a class="headerlink" href="#database-installation" title="Link to this heading">¶</a></h5>
<p>We offer the SNAILS database collection in both MS SQL and Sqlite formats.</p>
<p>To run any SNAILS reproducibility scripts, you must first download the MS SQL backup files here:</p>
<p><a class="reference external" href="https://drive.google.com/file/d/1EMQmdNx-a20TfZSDdNkFPLmXVS48IB2b/view?usp=drive_link">https://drive.google.com/file/d/1EMQmdNx-a20TfZSDdNkFPLmXVS48IB2b/view?usp=drive_link</a></p>
<p>If you’re running <strong>Windows</strong>, you can either use Docker or import the provided .bak files into a MS SQL server database
<a class="reference external" href="https://learn.microsoft.com/en-us/sql/relational-databases/backup-restore/quickstart-backup-restore-database?view=sql-server-ver16&amp;tabs=ssms">following the steps here</a>.</p>
<p>Once you’ve imported the .bak files into an MS SQL database, you’ll need to configure the <code class="docutils literal notranslate"><span class="pre">.local/dbinfo.json</span></code> file for your system’s login credentials. If this is too complicated, then consider using the Docker-based approach below.</p>
<p>For <strong>Linux</strong>, <strong>WSL</strong>, or <strong>Apple</strong> users, we recommend the Docker-based approach.</p>
<ol class="arabic">
<li><p>Download the <code class="docutils literal notranslate"><span class="pre">SNAILS_database_collection.tar.gz</span></code> from the link above into <code class="docutils literal notranslate"><span class="pre">./SNAILS_Artifacts/databases/</span></code></p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">./SNAILS_Artifacts/databases/</span></code> directory, Run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">install_snails_db</span><span class="o">.</span><span class="n">sh</span>
<span class="n">bash</span> <span class="n">run_docker_snails_db</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
</ol>
<p>This will build a MS SQL docker image, copy the .bak files into the container, and unzip and import the .bak files into the database. It will also copy the required <code class="docutils literal notranslate"><span class="pre">dbinfo.json</span></code> file into the <code class="docutils literal notranslate"><span class="pre">./.local/</span></code> directory.</p>
<p><strong>SNAILS SQlite</strong> is required for reproducing CodeS-based inference.</p>
<p><a class="reference external" href="https://drive.google.com/file/d/16vgE_KCZMdKDKHtXgIQhvWdwO7ufKcjz/view?usp=drive_link">Download the collection</a> and unzip into the <code class="docutils literal notranslate"><span class="pre">./db/snails_sqlite/</span></code> directory.</p>
<div class="toctree-wrapper compound">
</div>
</section>
</div>
</section>
<span id="document-artifacts/naturalness_classifications"></span><section id="snails-identifier-naturalness-data">
<h4>SNAILS Identifier Naturalness data<a class="headerlink" href="#snails-identifier-naturalness-data" title="Link to this heading">¶</a></h4>
<section id="dataset-generation">
<h5>Dataset Generation<a class="headerlink" href="#dataset-generation" title="Link to this heading">¶</a></h5>
<p>We made several different attempts at schema identifier naturalness classification including human scoring, heuristics-based, and machine learning.
Ultimately, we generated a ground truth dataset by validating and, where needed, modifying labels classified by a finetuned GPT davinci classification model.
Using this dataset, we then trained a local model based on Canine that outperforms the GPT-based model.</p>
</section>
<section id="dataset-download">
<h5>Dataset Download<a class="headerlink" href="#dataset-download" title="Link to this heading">¶</a></h5>
<p>The dataset can be accessed on our
<a class="reference external" href="https://github.com/KyleLuoma/SNAILS/tree/main/SNAILS_Artifacts/naturalness_classifications">GitHub repository</a>.</p>
<div class="toctree-wrapper compound">
</div>
</section>
</section>
<span id="document-artifacts/naturalness_classifiers"></span><section id="naturalness-classifiers">
<span id="id1"></span><h4>Naturalness Classifiers<a class="headerlink" href="#naturalness-classifiers" title="Link to this heading">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-artifacts/naturalness_classifiers/canine_naturalness_classifier"></span><section id="snails-naturalness-classifier">
<span id="id1"></span><h5>snails_naturalness_classifier<a class="headerlink" href="#snails-naturalness-classifier" title="Link to this heading">¶</a></h5>
<dl class="py class">
<dt class="sig sig-object py" id="CanineIdentifierClassifier">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">CanineIdentifierClassifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifiers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pd.DataFrame()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CanineIdentifierClassifier" title="Link to this definition">¶</a></dt>
<dd><p>A classifier for identifying word naturalness using a pre-trained text analysis model.
Classifies words as Regular (label N1), Low (label N2), or Least (label N3) natural.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>identifiers</strong> (<em>pd.DataFrame</em>) – A DataFrame containing identifiers to classify.</p>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>model_name</strong> (<em>str</em>) – The name of the model used for classification.</p></li>
<li><p><strong>checkpoint</strong> (<em>int</em>) – The checkpoint number of the model.</p></li>
<li><p><strong>id2label</strong> (<em>dict</em>) – A dictionary mapping label IDs to label names.</p></li>
<li><p><strong>label2id</strong> (<em>dict</em>) – A dictionary mapping label names to label IDs.</p></li>
<li><p><strong>classifier</strong> (<em>pipeline</em>) – The sentiment analysis pipeline used for classification.</p></li>
<li><p><strong>identifiers</strong> (<em>pd.DataFrame</em>) – A DataFrame containing identifiers to classify.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="CanineIdentifierClassifier.do_batch_job">
<span class="sig-name descname"><span class="pre">do_batch_job</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ident_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pd.DataFrame</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_as_excel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CanineIdentifierClassifier.do_batch_job" title="Link to this definition">¶</a></dt>
<dd><p>Performs batch classification on the given DataFrame of identifiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ident_df</strong> (<em>pd.DataFrame</em><em> or </em><em>None</em>) – The DataFrame of identifiers to classify. Defaults to None, in which case it uses <code class="xref py py-attr docutils literal notranslate"><span class="pre">identifiers</span></code>.</p></li>
<li><p><strong>save_as_excel</strong> (<em>bool</em>) – Whether to save the results as an Excel file.</p></li>
<li><p><strong>make_tag</strong> (<em>bool</em>) – Whether to add a token tag to the text before classification.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CanineIdentifierClassifier.classify_identifier">
<span class="sig-name descname"><span class="pre">classify_identifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CanineIdentifierClassifier.classify_identifier" title="Link to this definition">¶</a></dt>
<dd><p>Classifies a single identifier.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier</strong> (<em>str</em>) – The identifier to classify.</p></li>
<li><p><strong>make_tag</strong> (<em>bool</em>) – Whether to add a token tag to the identifier before classification.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The classification result.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-artifacts/naturalness_classifiers/schemaclassifier"></span><section id="db-schema-classifier">
<span id="id1"></span><h5>db_schema_classifier<a class="headerlink" href="#db-schema-classifier" title="Link to this heading">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="classify_db_schema">
<span class="sig-name descname"><span class="pre">classify_db_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tagged</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ms</span> <span class="pre">sql'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#classify_db_schema" title="Link to this definition">¶</a></dt>
<dd><p>Classifies the naturalness of table and column names in a database schema.
This relies on the SNAILS db_util.py or db_util_sqlite.py utilities which means
that databases must be registered in the ./.local/dbinfo.json or dbinfo_sqlite.json files prior to use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_name</strong> (<em>str</em>) – The name of the database to classify.</p></li>
<li><p><strong>tagged</strong> (<em>bool</em>) – Whether to tag the identifiers.</p></li>
<li><p><strong>db_type</strong> (<em>str</em>) – The type of the database, either ‘ms sql’ or ‘sqlite’.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ModuleNotFoundError</strong> – If the snails_naturalness_classifier module is not found.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A DataFrame containing the table names, table scores, column names, column scores, and model used.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="classify_batch_with_canine">
<span class="sig-name descname"><span class="pre">classify_batch_with_canine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_filepath</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#classify_batch_with_canine" title="Link to this definition">¶</a></dt>
<dd><p>Classifies tables and columns in a batch file using the CanineIdentifierClassifier.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>batch_filepath</strong> (<em>str</em>) – The file path to the batch CSV file containing table and column names.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame containing the table names, table scores, column names, column scores, and the model used for classification. If the input DataFrame contains a ‘DATABASE_NAME’ column, it will also be included in the output DataFrame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="main">
<span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#main" title="Link to this definition">¶</a></dt>
<dd><p>Main function to demonstrate the usage of the schema classification functions.  This function sets a database name, then calls the <code class="docutils literal notranslate"><span class="pre">classify_db_schema</span></code> function.  Commented-out lines show alternative usage scenarios.</p>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
</div>
<section id="classification-models">
<h5>Classification Models<a class="headerlink" href="#classification-models" title="Link to this heading">¶</a></h5>
<p>Model performance data is logged in the <code class="docutils literal notranslate"><span class="pre">./data/classifier-inference-results</span></code> directory, and includes outputs and classification score calculations for the models described below.</p>
<p><strong>Classes</strong></p>
<ul class="simple">
<li><p>N1: Regular</p></li>
<li><p>N2: Low</p></li>
<li><p>N3: Least</p></li>
</ul>
<p><strong>The Tagging Feature</strong></p>
<p>If a model below is referred to as “tagged”, it means that we employed a feature we call character tagging implemented in <a class="reference internal" href="#tokenprocessing"><span class="std std-ref">tokenprocessing</span></a>.</p>
<p><strong>Canine</strong></p>
<p><em>Training</em></p>
<p>Training was performed using the Transformers library with the Canine pretrained language model.</p>
<p>We finetuned the model using an Nvidia GTX 1080 GPU with 8GiB of VRAM using transformers libraries, CUDA 12.1 and Torch 2.0.1.</p>
<p><em>Collection 1 data</em></p>
<p>Generation 1 used the same human-generated training data as the davinci finetune in .csv format found in <code class="docutils literal notranslate"><span class="pre">./manual-scoring/gpt-data/</span></code></p>
<p><em>Collection 2 data</em></p>
<p>Generation 2 was trained on an expanded set of training data that was generated by the davinci fine tune and curated by human researchers:
<code class="docutils literal notranslate"><span class="pre">./manual-scoring/canine2/</span></code></p>
<p><em>Inference</em></p>
<p>Inference is accomplished with the CanineIdentifierClassifier class: <a class="reference internal" href="#snails-naturalness-classifier"><span class="std std-ref">snails_naturalness_classifier</span></a>.</p>
<p>This class assumes the availability of a canine-based model trained using the steps described above.
The best-performing classifier is available on HuggingFace: <a class="reference external" href="https://huggingface.co/kyleluoma/SNAILS-word-naturalness-classifier">https://huggingface.co/kyleluoma/SNAILS-word-naturalness-classifier</a></p>
<p><strong>Classification Heuristics</strong>
Our heuristics-based approach is called Word List Matching, and is implemented in
<a class="reference internal" href="#word-list-matching"><span class="std std-ref">word_list_matching</span></a>.</p>
<p><strong>GPT 3.5 Turbo Fewshot Classification</strong>
No training was required for the fewshot classification approach, we simply use the OpenAI API and a pre-written completions prompt which is located at <code class="docutils literal notranslate"><span class="pre">./prompts/fewshot-categoryexplanations.txt</span></code>.</p>
<p><strong>GPT Davinci Fine Tune | DEPRECATED</strong></p>
<p>The GPT Davinci finetuned model is no longer available from OpenAI.
We include this writeup for completeness.</p>
<p><em>Training</em></p>
<p>Finetuning was accomplished using the OpenAI API training endpoint.</p>
<p>Example command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openai</span> <span class="n">api</span> <span class="n">fine_tunes</span><span class="o">.</span><span class="n">create</span> <span class="o">-</span><span class="n">t</span> <span class="o">.</span>\<span class="n">manual</span><span class="o">-</span><span class="n">scoring</span>\<span class="n">gpt</span><span class="o">-</span><span class="n">data</span>\<span class="n">train_tagged_prepared</span><span class="o">.</span><span class="n">jsonl</span> <span class="o">-</span><span class="n">m</span> <span class="n">davinci</span> <span class="o">--</span><span class="n">suffix</span> <span class="s2">&quot;tagged_classifier&quot;</span>
</pre></div>
</div>
<p>Training data is in <code class="docutils literal notranslate"><span class="pre">./data/classifier-training-data/</span></code></p>
<p><em>Inference</em></p>
<p>Inference is no longer possible.</p>
</section>
</section>
<span id="document-artifacts/naturalness_modified_identifiers"></span><p>:: _naturalness_modified_identifiers:</p>
<section id="naturalness-modified-identifiers">
<h4>Naturalness-Modified Identifiers<a class="headerlink" href="#naturalness-modified-identifiers" title="Link to this heading">¶</a></h4>
<section id="dataset-description">
<h5>Dataset Description<a class="headerlink" href="#dataset-description" title="Link to this heading">¶</a></h5>
<p><strong>Creation</strong>
We created the naturalness-modified data using our <a class="reference internal" href="#schemarenamer"><span class="std std-ref">schemarenamer</span></a> artifacts.
Each output from these tools was validated, and when necessary modified, by a human researcher.</p>
<p><strong>Dataset Description</strong>
The data are stored as .xlsx crosswalks that map the native identifier to higher and/or lower naturalness levels.</p>
<p><em>Columns</em></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Column Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>native_identifier</p></td>
<td><p>The identifier as it exists in the SNAILS database.</p></td>
</tr>
<tr class="row-odd"><td><p>table_or_columns</p></td>
<td><p>Indicates if the identifier is a table or column.</p></td>
</tr>
<tr class="row-even"><td><p>source_database</p></td>
<td><p>Database from which the identifier was extracted.</p></td>
</tr>
<tr class="row-odd"><td><p>native_naturalness</p></td>
<td><p>The naturalness level of the native identifier.</p></td>
</tr>
<tr class="row-even"><td><p>N1_identifier</p></td>
<td><p>The Regular (N1) variant of the native identifier.</p></td>
</tr>
<tr class="row-odd"><td><p>N2_identifier</p></td>
<td><p>The Low (N2) variant of the native identifier.</p></td>
</tr>
<tr class="row-even"><td><p>N3_identifier</p></td>
<td><p>The Least (N3) variant of the native identifier.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dataset-download">
<h5>Dataset Download<a class="headerlink" href="#dataset-download" title="Link to this heading">¶</a></h5>
<p>The dataset can be accessed on our
<a class="reference external" href="https://github.com/KyleLuoma/SNAILS/tree/main/SNAILS_Artifacts/naturalness_modified_identifiers">GitHub repository</a>.</p>
<div class="toctree-wrapper compound">
</div>
</section>
</section>
<span id="document-artifacts/naturalness_modifier"></span><section id="naturalness-modifier">
<span id="id1"></span><h4>Naturalness Modifier<a class="headerlink" href="#naturalness-modifier" title="Link to this heading">¶</a></h4>
<p>Schema Identifier Transformation and Naturalness-Modified Identifier Generation</p>
<p>To better observe the effect of naturalness levels on linking performance, we create alternate versions of all identifiers in the benchmark datasets.</p>
<p>Naturalness modification is performed the using <a class="reference internal" href="#schemarenamer"><span class="std std-ref">schemarenamer</span></a> <code class="docutils literal notranslate"><span class="pre">do_fewshot_identifier_transform</span></code> function.</p>
<section id="more-natural-to-less-natural">
<h5>More natural to less natural<a class="headerlink" href="#more-natural-to-less-natural" title="Link to this heading">¶</a></h5>
<p>Creating a less natural version of a natural identifier is a task of abbreviation. Less natural identifiers should contain elements of the full words that they represent.</p>
<p>in cases of transformation from higher to lower naturalness levels, do_fewshot_identifier_transform passes the fewshot prompts in the <code class="docutils literal notranslate"><span class="pre">./prompts/</span></code> directory to our callgpt.call_gpt function:</p>
</section>
<section id="less-natural-to-more-natural">
<h5>Less natural to more natural<a class="headerlink" href="#less-natural-to-more-natural" title="Link to this heading">¶</a></h5>
<p>Less natural to more natural transformation makes use of the <a class="reference internal" href="#data-dict-interpreter"><span class="std std-ref">data_dict_interpreter</span></a>. This program uses database metadata (xml, pdf, or csv format) and GPT fewshot prompting to expand abbreviated identifiers.</p>
<div class="toctree-wrapper compound">
<span id="document-artifacts/naturalness_modifier/data_dict_interpreter"></span><section id="data-dict-interpreter">
<span id="id1"></span><h6>data_dict_interpreter<a class="headerlink" href="#data-dict-interpreter" title="Link to this heading">¶</a></h6>
<dl class="py class">
<dt class="sig sig-object py" id="DataDictInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DataDictInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dict_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#DataDictInterpreter" title="Link to this definition">¶</a></dt>
<dd><p>This class is used to interpret a data dictionary. This is a superclass. Subclasses exist for different document types.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em><em> or </em><em>None</em>) – The name of the database.</p></li>
<li><p><strong>data_dict_file</strong> (<em>str</em><em> or </em><em>None</em>) – The path to the data dictionary file.</p></li>
</ul>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>index</strong> (<em>defaultdict</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>]</em><em>]</em><em>]</em>) – A dictionary mapping words to a list of locations in the document.</p></li>
<li><p><strong>data_dict_file</strong> (<em>str</em>) – The path to the data dictionary file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – The name of the fewshot prompt file for a data dictionary.</p></li>
<li><p><strong>call_gpt</strong> (<em>function</em>) – A function that takes a prompt and returns a GPT response.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="DataDictInterpreter.interactive_prompt_builder">
<span class="sig-name descname"><span class="pre">interactive_prompt_builder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_examples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#DataDictInterpreter.interactive_prompt_builder" title="Link to this definition">¶</a></dt>
<dd><p>User interaction method to build a fewshot prompt for a data dictionary.</p>
<p>The interaction prompts the user to provide a valid database identifier for the document.
The user is then prompted to confirm whether the generated identifier is a good example.
If the user confirms the example is good, the example is added to the fewshot prompt.
The user is then prompted to provide another valid database identifier for the document.
This process repeats until the user has provided the desired number of examples.
The user is then asked if the prompt should be saved to disk and used for the data dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>num_examples</strong> (<em>int</em>) – The number of examples to generate for the fewshot prompt.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="DataDictInterpreter.make_zero_shot_prompt">
<span class="sig-name descname"><span class="pre">make_zero_shot_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context_limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#DataDictInterpreter.make_zero_shot_prompt" title="Link to this definition">¶</a></dt>
<dd><p>Generates a zero-shot prompt for a data dictionary.</p>
<p>This method generates a zero-shot prompt for a data dictionary.
The prompt is generated using the identifier provided by the user and the context around the identifier in the data dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier</strong> (<em>str</em>) – The identifier to generate a zero-shot prompt for.</p></li>
<li><p><strong>context_limit</strong> (<em>int</em>) – The limit on the number of instances of the identifier referenced within the text of the data dictionary to include in the prompt.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A zero-shot prompt for the data dictionary.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="DataDictInterpreter.make_few_shot_prompt">
<span class="sig-name descname"><span class="pre">make_few_shot_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context_limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#DataDictInterpreter.make_few_shot_prompt" title="Link to this definition">¶</a></dt>
<dd><p>Generates a few-shot prompt for a data dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier</strong> (<em>str</em>) – The identifier to generate a few-shot prompt for.</p></li>
<li><p><strong>context_limit</strong> (<em>int</em>) – The limit on the number of instances of the identifier referenced within the text of the data dictionary to include in the prompt.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Whether to print verbose output.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A few-shot prompt for the data dictionary.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="DataDictInterpreter.getNaturalIdentifier">
<span class="sig-name descname"><span class="pre">getNaturalIdentifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#DataDictInterpreter.getNaturalIdentifier" title="Link to this definition">¶</a></dt>
<dd><p>Returns the natural identifier for a database identifier.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier</strong> (<em>str</em>) – The identifier to get the natural identifier for.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Whether to print verbose output.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The natural identifier for the database identifier.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="DataDictInterpreter.get_context_around_identifier">
<span class="sig-name descname"><span class="pre">get_context_around_identifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#DataDictInterpreter.get_context_around_identifier" title="Link to this definition">¶</a></dt>
<dd><p>Returns the context around an identifier in a data dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier</strong> (<em>str</em>) – The identifier to get the context around.</p></li>
<li><p><strong>beam_width</strong> (<em>int</em><em> or </em><em>None</em>) – The number of characters/words to include on either side of the identifier.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of strings containing the context around the identifier.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="DataDictInterpreter.index_dictionary_file">
<span class="sig-name descname"><span class="pre">index_dictionary_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_obj</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">defaultdict</span></span></span><a class="headerlink" href="#DataDictInterpreter.index_dictionary_file" title="Link to this definition">¶</a></dt>
<dd><p>Indexes a data dictionary file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_obj</strong> (<em>Varies depending on subclass.</em>) – The file object to index.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A defaultdict mapping words to a list of locations in the document.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>defaultdict[str, list]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="PdfDataDictInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PdfDataDictInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dict_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PdfDataDictInterpreter" title="Link to this definition">¶</a></dt>
<dd><p>This class is used to interpret a PDF data dictionary. Inherits from <a class="reference internal" href="#DataDictInterpreter" title="DataDictInterpreter"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataDictInterpreter</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pdf</strong> (<em>PdfReader</em>) – A PdfReader object representing the PDF data dictionary.</p></li>
<li><p><strong>beam_width</strong> (<em>int</em>) – The number of characters to include on either side of the identifier.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="PdfDataDictInterpreter.get_context_around_identifier">
<span class="sig-name descname"><span class="pre">get_context_around_identifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#PdfDataDictInterpreter.get_context_around_identifier" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">..</span> <span class="pre">:inheritdoc::</span> <span class="pre">DataDictInterpreter.get_context_around_identifier</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="PdfDataDictInterpreter.index_dictionary_file">
<span class="sig-name descname"><span class="pre">index_dictionary_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PdfReader</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">defaultdict</span></span></span><a class="headerlink" href="#PdfDataDictInterpreter.index_dictionary_file" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">..</span> <span class="pre">:inheritdoc::</span> <span class="pre">DataDictInterpreter.index_dictionary_file</span></span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="XmlDataDictInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">XmlDataDictInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dict_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#XmlDataDictInterpreter" title="Link to this definition">¶</a></dt>
<dd><p>This class is used to interpret an XML data dictionary. Inherits from <a class="reference internal" href="#DataDictInterpreter" title="DataDictInterpreter"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataDictInterpreter</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xml_text</strong> (<em>str</em>) – A string containing the text of the XML data dictionary.</p></li>
<li><p><strong>xml_list</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – A list of words in the XML data dictionary.</p></li>
<li><p><strong>beam_width</strong> (<em>int</em>) – The number of words to include on either side of the identifier.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="XmlDataDictInterpreter.get_context_around_identifier">
<span class="sig-name descname"><span class="pre">get_context_around_identifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#XmlDataDictInterpreter.get_context_around_identifier" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">..</span> <span class="pre">:inheritdoc::</span> <span class="pre">DataDictInterpreter.get_context_around_identifier</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="XmlDataDictInterpreter.index_dictionary_file">
<span class="sig-name descname"><span class="pre">index_dictionary_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_obj</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">defaultdict</span></span></span><a class="headerlink" href="#XmlDataDictInterpreter.index_dictionary_file" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">..</span> <span class="pre">:inheritdoc::</span> <span class="pre">DataDictInterpreter.index_dictionary_file</span></span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="CsvDataDictInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">CsvDataDictInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dict_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CsvDataDictInterpreter" title="Link to this definition">¶</a></dt>
<dd><p>This class is used to interpret a CSV data dictionary. Inherits from <a class="reference internal" href="#DataDictInterpreter" title="DataDictInterpreter"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataDictInterpreter</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>csv</strong> (<em>str</em>) – The CSV data as a string.</p></li>
<li><p><strong>csv_header</strong> (<em>str</em>) – The header row of the CSV.</p></li>
<li><p><strong>beam_width</strong> (<em>int</em>) – The number of lines to include around the identifier.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="CsvDataDictInterpreter.get_context_around_identifier">
<span class="sig-name descname"><span class="pre">get_context_around_identifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#CsvDataDictInterpreter.get_context_around_identifier" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">..</span> <span class="pre">:inheritdoc::</span> <span class="pre">DataDictInterpreter.get_context_around_identifier</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CsvDataDictInterpreter.index_dictionary_file">
<span class="sig-name descname"><span class="pre">index_dictionary_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_obj</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">defaultdict</span></span></span><a class="headerlink" href="#CsvDataDictInterpreter.index_dictionary_file" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">..</span> <span class="pre">:inheritdoc::</span> <span class="pre">DataDictInterpreter.index_dictionary_file</span></span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="JsonDataDictInterpreter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">JsonDataDictInterpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dict_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#JsonDataDictInterpreter" title="Link to this definition">¶</a></dt>
<dd><p>This class is used to interpret a JSON data dictionary. Inherits from <a class="reference internal" href="#DataDictInterpreter" title="DataDictInterpreter"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataDictInterpreter</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>json_text</strong> (<em>str</em>) – The JSON data as a string.</p></li>
<li><p><strong>json_list</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – A list of words in the JSON data.</p></li>
<li><p><strong>beam_width</strong> (<em>int</em>) – The number of words to include around the identifier.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="JsonDataDictInterpreter.get_context_around_identifier">
<span class="sig-name descname"><span class="pre">get_context_around_identifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#JsonDataDictInterpreter.get_context_around_identifier" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">..</span> <span class="pre">:inheritdoc::</span> <span class="pre">DataDictInterpreter.get_context_around_identifier</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="JsonDataDictInterpreter.index_dictionary_file">
<span class="sig-name descname"><span class="pre">index_dictionary_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_obj</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">defaultdict</span></span></span><a class="headerlink" href="#JsonDataDictInterpreter.index_dictionary_file" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">..</span> <span class="pre">:inheritdoc::</span> <span class="pre">DataDictInterpreter.index_dictionary_file</span></span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="DataDictInterpreterFactory">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DataDictInterpreterFactory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#DataDictInterpreterFactory" title="Link to this definition">¶</a></dt>
<dd><p>Factory class for creating DataDictInterpreter objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>database_name</strong> (<em>str</em>) – The name of the database.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="DataDictInterpreterFactory.get_current_interpreter">
<span class="sig-name descname"><span class="pre">get_current_interpreter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#DataDictInterpreter" title="DataDictInterpreter"><span class="pre">DataDictInterpreter</span></a></span></span><a class="headerlink" href="#DataDictInterpreterFactory.get_current_interpreter" title="Link to this definition">¶</a></dt>
<dd><p>Returns the current DataDictInterpreter object.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The current DataDictInterpreter object.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#DataDictInterpreter" title="DataDictInterpreter">DataDictInterpreter</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="DataDictInterpreterFactory.get_new_interpreter">
<span class="sig-name descname"><span class="pre">get_new_interpreter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#DataDictInterpreter" title="DataDictInterpreter"><span class="pre">DataDictInterpreter</span></a></span></span><a class="headerlink" href="#DataDictInterpreterFactory.get_new_interpreter" title="Link to this definition">¶</a></dt>
<dd><p>Creates and returns a new DataDictInterpreter object based on the database name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>database_name</strong> (<em>str</em>) – The name of the database.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new DataDictInterpreter object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#DataDictInterpreter" title="DataDictInterpreter">DataDictInterpreter</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
</div>
</section>
</section>
<span id="document-artifacts/question_query_pairs"></span><section id="snails-nl-question-gold-sql-query-dataset">
<span id="question-query-pairs"></span><h4>SNAILS NL Question - Gold SQL Query dataset<a class="headerlink" href="#snails-nl-question-gold-sql-query-dataset" title="Link to this heading">¶</a></h4>
<p>Question - query pairs are stored as executable .sql files with questions entered as SQL comments.
Each question is delinated by a ‘;’ expression terminator.
In this repository, we store them in a .zip file <code class="docutils literal notranslate"><span class="pre">./queries/NL-Questions-and-Gold-Queries.zip</span></code> to avoid inadvertent inclusion in future LLM training data sets.</p>
<p>If you opt to use these in your own projects, please avoid publishing them where they can be scraped.</p>
<p>Example pair:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- 5: How many events observed at least some stage of decay?
select count(distinct Event_ID)
from tbl_Deadwood
;
</pre></div>
</div>
<p>To run SNAILS reproducibility scripts, you don’t need to interact with or manipulate the gold query file. <a class="reference internal" href="#load-nl-questions"><span class="std std-ref">load_nl_questions</span></a> handles this for you.</p>
<div class="toctree-wrapper compound">
</div>
</section>
</div>
</section>
<span id="document-natural_views/natural_views"></span><section id="natural-views">
<span id="id1"></span><h3>Natural Views<a class="headerlink" href="#natural-views" title="Link to this heading">¶</a></h3>
<img alt="_images/nat_view.png" src="_images/nat_view.png" />
<p>With natural views, we exploit the SQL view concept and map high naturalness identifiers to their native (possibly lower naturalness) representations.</p>
<p>This pipeline requires the <a class="reference internal" href="#snails-naturalness-classifier"><span class="std std-ref">snails_naturalness_classifier</span></a>, <a class="reference internal" href="#schemarenamer"><span class="std std-ref">schemarenamer</span></a>, and <a class="reference internal" href="#natural-view-builder"><span class="std std-ref">natural_view_builder</span></a> modules.</p>
<p>The <a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/classify_rename_and_build_view.py">Schema classification/modification, and view creation</a> script
is an end-to-end example of how to use SNAILS artifacts to improve database naturalness.</p>
<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-reproducibility/reproducibility"></span><section id="reproducing-snails-experiments">
<span id="reproducibility"></span><h3>Reproducing SNAILS Experiments<a class="headerlink" href="#reproducing-snails-experiments" title="Link to this heading">¶</a></h3>
<p>SNAILS experiments can be re-run using the provided Jupyter notebooks.
We also provide a Tkinter GUI-based SQL validation tool that should be used after executing notebook 1 and
before running the analysis in notebook 2.</p>
<div class="toctree-wrapper compound">
<span id="document-reproducibility/manual_validation"></span><section id="manual-sql-correctness-validation-tool">
<span id="manual-validation"></span><h4>Manual SQL Correctness Validation Tool<a class="headerlink" href="#manual-sql-correctness-validation-tool" title="Link to this heading">¶</a></h4>
<p>Because true semantic equivalence between a Gold and Predicted query is, more-or-less, unsolvable, we leave this task to the intrepid researcher.
To reduce the pain involved in SQL-SQL comparisons, we created a simple TKinter-based GUI-based app.</p>
<p>Open the app from the root directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">query_manual_validation</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>You should be greeted by a GUI window that looks similar to:</p>
<img alt="_images/man_validation.png" src="_images/man_validation.png" />
<p><strong>The Validation Proces:</strong></p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Load a performance annotation file by pressing the [Load] button.</dt><dd><p>NOTE: The load window defaults to <cite>./data/nl-to-sql-performance_annotations/pending_evaluation/</cite> which is the correct location.</p>
</dd>
</dl>
</li>
<li><p>Cycle through the ungraded queries that achieved result set matching by pressing the [Next Ungraded] button.</p></li>
<li><p>For each ungraded query, compare the Gold and Predicted varients and adjust the Manual Match score using the radio buttons.</p></li>
<li><dl class="simple">
<dt>Pressing [Next Ungraded] or [Next Question] saves your input.</dt><dd><p>NOTE: Alternately, for correct queries, pressing [Log Match and Next Ungraded] marks the query as correct and then loads the next ungraded query.</p>
</dd>
</dl>
</li>
</ol>
<ol class="arabic simple" start="6">
<li><dl class="simple">
<dt>Once Remaining Ungraded == 0, save the file by pressing the [Save] button.</dt><dd><p>NOTE: the save window defaults to <cite>./data/nl-to-sql-performance_annotations/</cite> which is the correct location to save.</p>
</dd>
</dl>
</li>
</ol>
<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-reproducibility/notebooks"></span><section id="snails-reproducibility-notebooks">
<span id="notebooks"></span><h4>SNAILS Reproducibility Notebooks<a class="headerlink" href="#snails-reproducibility-notebooks" title="Link to this heading">¶</a></h4>
<p>The SNAILS repository contains 10 numbered Jupyter notebooks in the root of the project.
Notebooks 1 - 3 must be run in-sequence. Notebooks 4 - 10 may be run in any order.</p>
<p>NOTE on database hosting: Reproduction requires an MS SQL database. This can either be hosted natively on a Windows OS, or via Docker (requires Docker installation) and the installation scripts provided in the archive.</p>
<p>Before running any notebooks, you must install dependences (<a class="reference internal" href="#installing"><span class="std std-ref">Installing SNAILS</span></a>) and instantiate the SNAILS databases (<a class="reference internal" href="#databases"><span class="std std-ref">SNAILS databases</span></a>).</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/01-SNAILS-NL-to-SQL-Inference-and-Scoring.ipynb">Run NL-to-SQL Inference and Auto Scoring</a>: Generates and evaluates SQL queries for both execution accuracy and schema linking performance. Outputs to <code class="docutils literal notranslate"><span class="pre">./data/nl-to-sql-performance_annotations/pending_evaluation/</span></code>.</dt><dd><p>NOTE: After running notebook 1 and prior to running notebook 2 analysis, manually review the generated SQL using the manual validation tool (<a class="reference internal" href="#manual-validation"><span class="std std-ref">Manual SQL Correctness Validation Tool</span></a>).</p>
</dd>
</dl>
</li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/02-SNAILS-NL-to-SQL-results-analysis.ipynb">Run Statistical Tests and Create Charts</a>: Loads validated performance annotations from <code class="docutils literal notranslate"><span class="pre">./data/nl-to-sql-performance_annotations/</span></code> and generates statistical tests and charts.</p></li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/SNAILS-identifier-analysis.ipynb">Run Identifier-Focused Analysis</a>: Loads validated performance annotations from <code class="docutils literal notranslate"><span class="pre">./data/nl-to-sql-performance_annotations/</span></code> and provides an identifier-focused schema linking performance metric.</p></li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/04-SNAILS-tokenizer-analysis.ipynb">Tokenizer Analysis</a>: Tokenizes SNAILS identifiers and explores their properties.</p></li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/05-SNAILS-token-naturalness-analysis.ipynb">Token Naturalness Analysis</a>: Explores the alignment of tokens to natural language.</p></li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/06-SNAILS-naturalness-comparisons.ipynb">Naturalness Comparisons</a>: Compares naturalness of SNAILS, Spider, Bird, and SchemaPile.</p></li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/07-schemapile-naturalness.ipynb">SchemaPile Naturalness</a>: ETL scripts for SchemaPile extraction and evaluation.</p></li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/08a-codes_query_execution_and_selection.ipynb">CodeS Query Execution and Selection</a>: Augments CodeS process to select the first correct SQL.</p></li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/08b-DINSQL-CodeS-schema-subsetting-analysis.ipynb">DINSQL CodeS Schema Subsetting Analysis</a>: Evaluates schema subsets generated by CodeS and DINSQL.</p></li>
<li><p><a class="reference external" href="https://github.com/KyleLuoma/SNAILS/blob/main/09-spider-query-analysis.ipynb">Spider Query Analysis</a>: Creates performance metrics for Spider DEV (Native and modified) inference.</p></li>
</ol>
<div class="toctree-wrapper compound">
</div>
</section>
</div>
</section>
<span id="document-src/src"></span><section id="src">
<span id="id1"></span><h3>src<a class="headerlink" href="#src" title="Link to this heading">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-src/end_to_end_data_prep_and_prediction"></span><section id="end-to-end-data-prep-and-prediction">
<span id="id1"></span><h4>end_to_end_data_prep_and_prediction<a class="headerlink" href="#end-to-end-data-prep-and-prediction" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">service</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naturalness</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bypass_nl_sql_inference</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.local/dbinfo.json'</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Executes the main logic for evaluating NL-to-SQL performance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – The name of the NL-to-SQL model.</p></li>
<li><p><strong>service</strong> – The name of the service providing the model.</p></li>
<li><p><strong>naturalness</strong> – The naturalness level of the schema (e.g., “NATIVE”, “N1”, “N2”, “N3”).</p></li>
<li><p><strong>database</strong> – The name of the database to use.</p></li>
<li><p><strong>bypass_nl_sql_inference</strong> – Whether to bypass NL-to-SQL inference and load predictions from a file.</p></li>
<li><p><strong>db_list_file</strong> – Path to the database information JSON file.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – If bypass_nl_sql_inference is True and the predicted queries file is not found.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mp_query_parse_function">
<span class="sig-name descname"><span class="pre">mp_query_parse_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="headerlink" href="#mp_query_parse_function" title="Link to this definition">¶</a></dt>
<dd><p>Parses a SQL query using an external Java tool and returns its statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>query_data</strong> – A tuple containing the query number, the SQL query string, and the SQL dialect.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the query number and a dictionary of query statistics.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mp_schema_linking_eval">
<span class="sig-name descname"><span class="pre">mp_schema_linking_eval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="headerlink" href="#mp_schema_linking_eval" title="Link to this definition">¶</a></dt>
<dd><p>Evaluates schema linking by comparing gold and predicted queries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> – A tuple containing the query number, the gold query, and the predicted query.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the query number and a dictionary of schema linking evaluation results.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="nl_to_sql_generation">
<span class="sig-name descname"><span class="pre">nl_to_sql_generation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q_nl_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pd.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bypass</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naturalness</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nat_cat_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_info</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.local/dbinfo.json'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_util</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">src.util.db_util</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pd.DataFrame</span></span></span><a class="headerlink" href="#nl_to_sql_generation" title="Link to this definition">¶</a></dt>
<dd><p>Generates SQL queries from natural language questions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q_nl_df</strong> – DataFrame containing natural language questions and other information.</p></li>
<li><p><strong>bypass</strong> – Whether to bypass NL-to-SQL generation and load from file.</p></li>
<li><p><strong>naturalness</strong> – Naturalness level for schema elements.</p></li>
<li><p><strong>db_name</strong> – Name of the database.</p></li>
<li><p><strong>config_dict</strong> – Configuration dictionary.</p></li>
<li><p><strong>nat_cat_dict</strong> – Dictionary mapping naturalness levels to numeric values.</p></li>
<li><p><strong>db_info</strong> – Database information dictionary.</p></li>
<li><p><strong>db_list_file</strong> – Path to database information JSON file.</p></li>
<li><p><strong>db_util</strong> – Database utility module.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataFrame with generated SQL queries.</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/natural_view_builder"></span><section id="natural-view-builder">
<span id="id1"></span><h4>natural_view_builder<a class="headerlink" href="#natural-view-builder" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="NaturalViewBuilder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">NaturalViewBuilder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xwalk_directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'./schema-xwalks/consolidated_and_validated'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#NaturalViewBuilder" title="Link to this definition">¶</a></dt>
<dd><p>A class used to build natural views for a database using crosswalks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>xwalk_directory</strong> (<em>str</em>) – The directory where the crosswalk files are stored. Defaults to “./schema-xwalks/consolidated_and_validated”.</p>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nat_label_lookup</strong> (<em>dict</em>) – A dictionary mapping naturalness levels to their labels.</p></li>
<li><p><strong>nat_num_lookup</strong> (<em>dict</em>) – A dictionary mapping naturalness labels to their levels.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="NaturalViewBuilder.initialize_db_nl_schema">
<span class="sig-prename descclassname"><span class="pre">NaturalViewBuilder.</span></span><span class="sig-name descname"><span class="pre">initialize_db_nl_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#NaturalViewBuilder.initialize_db_nl_schema" title="Link to this definition">¶</a></dt>
<dd><p>Initializes the natural language schema in the specified database.</p>
<p>This method performs the following steps:</p>
<ol class="arabic simple">
<li><p>Executes the SQL script to create the natural language schema.</p></li>
<li><p>Executes the SQL script to create a within-database naturalness crosswalk</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>database_name</strong> (<em>str</em>) – The name of the database where the schema will be initialized.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ProgrammingError</strong> – If there is an error executing the SQL script to create the schema.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="NaturalViewBuilder.populate_db_nl_tables">
<span class="sig-prename descclassname"><span class="pre">NaturalViewBuilder.</span></span><span class="sig-name descname"><span class="pre">populate_db_nl_tables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xwalk_directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#NaturalViewBuilder.populate_db_nl_tables" title="Link to this definition">¶</a></dt>
<dd><p>Populates the database natural language tables with cross-references between native and natural identifiers for tables and columns.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database to populate.</p></li>
<li><p><strong>xwalk_directory</strong> (<em>str</em><em>, </em><em>optional</em>) – The directory where the crosswalk Excel file is located. If not provided, defaults to self.xwalk_directory.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="NaturalViewBuilder.create_views_in_database">
<span class="sig-prename descclassname"><span class="pre">NaturalViewBuilder.</span></span><span class="sig-name descname"><span class="pre">create_views_in_database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naturalness_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#NaturalViewBuilder.create_views_in_database" title="Link to this definition">¶</a></dt>
<dd><p>Creates views in the specified database. If a naturalness level is provided, it creates a schema for that level and builds the views within that schema. Otherwise, it builds the views in the default schema.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database where views will be created.</p></li>
<li><p><strong>naturalness_level</strong> (<em>str</em><em>, </em><em>optional</em>) – The level of naturalness for the views. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="NaturalViewBuilder.build_natural_view_queries">
<span class="sig-prename descclassname"><span class="pre">NaturalViewBuilder.</span></span><span class="sig-name descname"><span class="pre">build_natural_view_queries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'dbo'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xwalk_directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">view_schema_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'db_nl'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naturalness_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'N1'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xwalk_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.DataFrame</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#NaturalViewBuilder.build_natural_view_queries" title="Link to this definition">¶</a></dt>
<dd><p>Builds SQL queries to create natural views for tables in a SQL Server database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database to query.</p></li>
<li><p><strong>target_schema</strong> (<em>str</em><em>, </em><em>optional</em>) – The schema of the target tables. Defaults to “dbo”.</p></li>
<li><p><strong>xwalk_directory</strong> (<em>str</em><em>, </em><em>optional</em>) – The directory containing the crosswalk files. Defaults to None.</p></li>
<li><p><strong>view_schema_name</strong> (<em>str</em><em>, </em><em>optional</em>) – The schema name for the views. Defaults to “db_nl”.</p></li>
<li><p><strong>naturalness_level</strong> (<em>str</em><em>, </em><em>optional</em>) – The level of naturalness for the identifiers. Defaults to “N1”.</p></li>
<li><p><strong>xwalk_df</strong> (<em>pandas.DataFrame</em><em>, </em><em>optional</em>) – The crosswalk dataframe. If None, it reads from the Excel file. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of SQL view creation queries.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/nl_to_sql_inference_and_prompt_generation"></span><section id="nl-to-sql-inference-and-prompt-generation">
<span id="id1"></span><h4>nl_to_sql_inference_and_prompt_generation<a class="headerlink" href="#nl-to-sql-inference-and-prompt-generation" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="do_single_question">
<span class="sig-name descname"><span class="pre">do_single_question</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">original_prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_database</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">question</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xwalk_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_naturalness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_naturalness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'GPT-FT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'query'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">service</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'openai'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'GPT-3.5'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sql</span> <span class="pre">server'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.local/dbinfo.json'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#do_single_question" title="Link to this definition">¶</a></dt>
<dd><p>Executes a single natural language question against a specified database using a specified AI service and generates a predicted SQL query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>original_prompt</strong> (<em>str</em>) – The initial prompt to be used.</p></li>
<li><p><strong>use_database</strong> (<em>str</em>) – The database to query.</p></li>
<li><p><strong>question</strong> (<em>str</em>) – The question to be appended to the prompt.</p></li>
<li><p><strong>xwalk_directory</strong> (<em>str</em><em>, </em><em>optional</em>) – Directory for crosswalk files. Defaults to None.</p></li>
<li><p><strong>column_naturalness</strong> (<em>int</em><em>, </em><em>optional</em>) – Level of naturalness for columns. Defaults to 0.</p></li>
<li><p><strong>table_naturalness</strong> (<em>int</em><em>, </em><em>optional</em>) – Level of naturalness for tables. Defaults to 0.</p></li>
<li><p><strong>log</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to log the attempt. Defaults to True.</p></li>
<li><p><strong>filename_suffix</strong> (<em>str</em><em>, </em><em>optional</em>) – Suffix for filenames. Defaults to ‘GPT-FT’.</p></li>
<li><p><strong>filename_prefix</strong> (<em>str</em><em>, </em><em>optional</em>) – Prefix for filenames. Defaults to ‘’.</p></li>
<li><p><strong>task</strong> (<em>str</em><em>, </em><em>optional</em>) – The task to perform (‘query’ or ‘tables’). Defaults to ‘query’.</p></li>
<li><p><strong>service</strong> (<em>str</em><em>, </em><em>optional</em>) – The AI service to use (‘openai’, ‘google-vertex’, ‘google-palm’, ‘code-llama-aws’, ‘togetherai’). Defaults to ‘openai’.</p></li>
<li><p><strong>model_name</strong> (<em>str</em><em>, </em><em>optional</em>) – The model name to use. Defaults to ‘GPT-3.5’.</p></li>
<li><p><strong>db_type</strong> (<em>str</em><em>, </em><em>optional</em>) – The type of database (‘sql server’ or ‘sqlite’). Defaults to “sql server”.</p></li>
<li><p><strong>db_list_file</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the database list file. Defaults to “.local/dbinfo.json”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the prompt, SQL response, result dataframe, naturalness, and denaturalized response.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="naturalize_prompt">
<span class="sig-name descname"><span class="pre">naturalize_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema_prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xwalk_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./db/schema-xwalks/consolidated_and_validated/'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_naturalness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_naturalness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'GPT-FT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#naturalize_prompt" title="Link to this definition">¶</a></dt>
<dd><p>Naturalize the prompt by replacing table and column names with natural language names.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>schema_prompt</strong> (<em>str</em>) – The prompt to naturalize.</p></li>
<li><p><strong>db_name</strong> (<em>str</em>) – The name of the database on which the resulting query will be run.</p></li>
<li><p><strong>xwalk_directory</strong> (<em>str</em><em>, </em><em>optional</em>) – The directory in which the crosswalk files are stored. Defaults to ‘./db/schema-xwalks/consolidated_and_validated/’.</p></li>
<li><p><strong>column_naturalness</strong> (<em>int</em><em>, </em><em>optional</em>) – The level of naturalness to use for column names. Defaults to 0.</p></li>
<li><p><strong>table_naturalness</strong> (<em>int</em><em>, </em><em>optional</em>) – The level of naturalness to use for table names. Defaults to 0.</p></li>
<li><p><strong>filename_suffix</strong> (<em>str</em><em>, </em><em>optional</em>) – The suffix to use for the crosswalk files. Defaults to ‘GPT-FT’.</p></li>
<li><p><strong>filename_prefix</strong> (<em>str</em><em>, </em><em>optional</em>) – The prefix to use for the crosswalk files. Defaults to ‘’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing a dictionary with the naturalness levels and the naturalized schema prompt.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[dict, str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="denaturalize_query">
<span class="sig-name descname"><span class="pre">denaturalize_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naturalness</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xwalk_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./db/schema-xwalks/consolidated_and_validated/'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PacificIslandLandbirds'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'GPT-FT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">syntax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tsql'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_naturalness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'native'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#denaturalize_query" title="Link to this definition">¶</a></dt>
<dd><p>Denaturalize a query by replacing natural language table and column names with their native identifiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>str</em>) – The query to denaturalize.</p></li>
<li><p><strong>naturalness</strong> (<em>dict</em>) – A dictionary with keys ‘table’ and ‘column’ and values corresponding to the naturalness level used for each.</p></li>
<li><p><strong>xwalk_directory</strong> (<em>str</em><em>, </em><em>optional</em>) – The directory in which the crosswalk files are stored.</p></li>
<li><p><strong>db_name</strong> (<em>str</em><em>, </em><em>optional</em>) – The name of the database on which the resulting query will be run. Defaults to ‘PacificIslandLandbirds’.</p></li>
<li><p><strong>filename_suffix</strong> (<em>str</em><em>, </em><em>optional</em>) – The suffix to use for the crosswalk files. Defaults to ‘GPT-FT’.</p></li>
<li><p><strong>filename_prefix</strong> (<em>str</em><em>, </em><em>optional</em>) – The prefix to use for the crosswalk files. Defaults to ‘’.</p></li>
<li><p><strong>syntax</strong> (<em>str</em><em>, </em><em>optional</em>) – The SQL syntax to use (‘tsql’ or ‘sqlite’). Defaults to ‘tsql’.</p></li>
<li><p><strong>target_naturalness</strong> (<em>str</em><em>, </em><em>optional</em>) – The target naturalness level. Defaults to “native”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The denaturalized query.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="log_attempt">
<span class="sig-name descname"><span class="pre">log_attempt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">response</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naturalness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'table':</span> <span class="pre">0,</span> <span class="pre">'column':</span> <span class="pre">0}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">denaturalized_response</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#log_attempt" title="Link to this definition">¶</a></dt>
<dd><p>Logs the attempt to a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>) – The prompt used.</p></li>
<li><p><strong>response</strong> (<em>str</em>) – The response received.</p></li>
<li><p><strong>result_df</strong> (<em>pandas.DataFrame</em>) – The result dataframe.</p></li>
<li><p><strong>database</strong> (<em>str</em>) – The database used.</p></li>
<li><p><strong>model_name</strong> (<em>str</em>) – The model name used.</p></li>
<li><p><strong>naturalness</strong> (<em>dict</em><em>, </em><em>optional</em>) – The naturalness level used. Defaults to {‘table’: 0, ‘column’: 0}.</p></li>
<li><p><strong>denaturalized_response</strong> (<em>str</em><em>, </em><em>optional</em>) – The denaturalized response. Defaults to None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="denaturalize_query_test">
<span class="sig-name descname"><span class="pre">denaturalize_query_test</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#denaturalize_query_test" title="Link to this definition">¶</a></dt>
<dd><p>Test function for denaturalize_query.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="do_single_question_test">
<span class="sig-name descname"><span class="pre">do_single_question_test</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#do_single_question_test" title="Link to this definition">¶</a></dt>
<dd><p>Test function for do_single_question.</p>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/query_manual_evaluation"></span><section id="query-manual-evaluation">
<span id="id1"></span><h4>query_manual_evaluation<a class="headerlink" href="#query-manual-evaluation" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="separate_by_line">
<span class="sig-name descname"><span class="pre">separate_by_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#separate_by_line" title="Link to this definition">¶</a></dt>
<dd><p>Formats a SQL query string for better readability by adding newlines before keywords.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>query</strong> (<em>str</em>) – The input SQL query string.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The formatted query string.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="clean">
<span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">elmnt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#clean" title="Link to this definition">¶</a></dt>
<dd><p>Removes set notation characters from a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>elmnt</strong> (<em>str</em>) – The input string.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The cleaned string.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="evaluate_queries_in_workbook">
<span class="sig-name descname"><span class="pre">evaluate_queries_in_workbook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">init_file_open_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#evaluate_queries_in_workbook" title="Link to this definition">¶</a></dt>
<dd><p>Opens a GUI window to evaluate SQL queries stored in an Excel workbook.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>init_file_open_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – Initial directory to open the workbook from. Defaults to None.</p></li>
<li><p><strong>init_filename</strong> (<em>str</em><em>, </em><em>optional</em>) – Initial filename of the workbook to open. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The annotated workbook as a pandas DataFrame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<dl class="py class">
<dt class="sig sig-object py" id="DfVariable">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DfVariable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tk.Variable</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#DfVariable" title="Link to this definition">¶</a></dt>
<dd><p>A Tkinter variable subclass to store and manage pandas DataFrames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>value</strong> (<em>pd.DataFrame</em><em>, </em><em>optional</em>) – The initial DataFrame value. Defaults to None.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="DfVariable.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#DfVariable.get" title="Link to this definition">¶</a></dt>
<dd><p>Returns the stored DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The DataFrame.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="DfVariable.set">
<span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#DfVariable.set" title="Link to this definition">¶</a></dt>
<dd><p>Sets the DataFrame value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>value</strong> (<em>pd.DataFrame</em>) – The new DataFrame.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/query_profiler"></span><section id="query-profiler">
<span id="id1"></span><h4>query_profiler<a class="headerlink" href="#query-profiler" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="QueryProfiler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">QueryProfiler</span></span><a class="headerlink" href="#QueryProfiler" title="Link to this definition">¶</a></dt>
<dd><p>A class to parse and profile queries using our java-based query parser analyzer.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>__jar_path</strong> (<em>str</em>) – The path to the jar file for the query parser analyzer.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – The query to be parsed and profiled.</p></li>
<li><p><strong>tree</strong> (<em>dict</em>) – The tree representation of the query.</p></li>
<li><p><strong>stats</strong> (<em>dict</em>) – The statistics of the query.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="QueryProfiler.profile_query">
<span class="sig-name descname"><span class="pre">profile_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#QueryProfiler.profile_query" title="Link to this definition">¶</a></dt>
<dd><p>Parses and profiles the query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>query</strong> (<em>str</em>) – The query to be parsed and profiled.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the parse tree and statistics of the query.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="QueryProfiler.get_identifiers_and_labels">
<span class="sig-name descname"><span class="pre">get_identifiers_and_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distinct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_brackets</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#QueryProfiler.get_identifiers_and_labels" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dictionary of the identifiers and labels in the query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>str</em><em> or </em><em>None</em>) – The query to be parsed (optional, defaults to self.query).</p></li>
<li><p><strong>distinct</strong> (<em>bool</em>) – Whether to return distinct identifiers (default is True).</p></li>
<li><p><strong>include_brackets</strong> (<em>bool</em>) – Whether to include brackets in identifiers (default is True).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing lists of tables, columns, logical operators, functions, and a dictionary of clauses.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="QueryProfiler.get_identifiers_and_labels_df">
<span class="sig-name descname"><span class="pre">get_identifiers_and_labels_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_brackets</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.DataFrame</span></span></span><a class="headerlink" href="#QueryProfiler.get_identifiers_and_labels_df" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe of the identifiers and labels in the query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>str</em><em> or </em><em>None</em>) – The query to be parsed (optional, defaults to self.query).</p></li>
<li><p><strong>query_num</strong> (<em>int</em>) – The query number (default is -1).</p></li>
<li><p><strong>include_brackets</strong> (<em>bool</em>) – Whether to include brackets in identifiers (default is True).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A Pandas DataFrame containing the query number, identifier type, and identifier value.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="QueryProfiler.tag_query">
<span class="sig-name descname"><span class="pre">tag_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">syntax</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'tsql'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#QueryProfiler.tag_query" title="Link to this definition">¶</a></dt>
<dd><p>Tags a query’s table and column names using the java-based query parser analyzer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>str</em>) – The query to be tagged.</p></li>
<li><p><strong>syntax</strong> (<em>str</em>) – The syntax of the query (default is “tsql”). Available options: “tsql”, “sqlite”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the tagged query, table aliases, and column aliases.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="QueryProfiler.__parse_query">
<span class="sig-name descname"><span class="pre">__parse_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">syntax</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'mssql'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#QueryProfiler.__parse_query" title="Link to this definition">¶</a></dt>
<dd><p>Parses a query using the java-based query parser analyzer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>str</em>) – The query to be parsed.</p></li>
<li><p><strong>syntax</strong> (<em>str</em>) – The syntax of the query (default is “mssql”). Currently only “mssql” is supported.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the parse tree and statistics of the query.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="QueryProfiler.parse_tree_pretty_print">
<span class="sig-name descname"><span class="pre">parse_tree_pretty_print</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#QueryProfiler.parse_tree_pretty_print" title="Link to this definition">¶</a></dt>
<dd><p>Prints a formatted representation of the parse tree.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tree</strong> (<em>dict</em><em> or </em><em>None</em>) – The parse tree to print (optional, defaults to self.tree).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="QueryProfiler.__single_obj_dict_to_tuple">
<span class="sig-name descname"><span class="pre">__single_obj_dict_to_tuple</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_in</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="headerlink" href="#QueryProfiler.__single_obj_dict_to_tuple" title="Link to this definition">¶</a></dt>
<dd><p>Converts a single-key dictionary to a tuple.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dict_in</strong> (<em>dict</em>) – The dictionary to convert.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the key and value of the input dictionary.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tag_query_test">
<span class="sig-name descname"><span class="pre">tag_query_test</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#tag_query_test" title="Link to this definition">¶</a></dt>
<dd><p>Tests the <code class="docutils literal notranslate"><span class="pre">tag_query</span></code> method.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="profile_query_test">
<span class="sig-name descname"><span class="pre">profile_query_test</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#profile_query_test" title="Link to this definition">¶</a></dt>
<dd><p>Tests the <code class="docutils literal notranslate"><span class="pre">profile_query</span></code> method.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="print_tagged_query">
<span class="sig-name descname"><span class="pre">print_tagged_query</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#print_tagged_query" title="Link to this definition">¶</a></dt>
<dd><p>Prints a tagged query and its statistics.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="all_tests">
<span class="sig-name descname"><span class="pre">all_tests</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#all_tests" title="Link to this definition">¶</a></dt>
<dd><p>Runs all test functions.</p>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/schema_graph"></span><section id="schema-graph">
<span id="id1"></span><h4>schema_graph<a class="headerlink" href="#schema-graph" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="SchemaGraph">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">SchemaGraph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repair_constraints</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_single_starting_table_for_connections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SchemaGraph" title="Link to this definition">¶</a></dt>
<dd><p>A class to represent a schema graph for a database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database.</p></li>
<li><p><strong>repair_constraints</strong> (<em>bool</em>) – A flag indicating whether to repair constraints. Defaults to True.</p></li>
<li><p><strong>use_single_starting_table_for_connections</strong> (<em>bool</em>) – A flag indicating whether to use a single starting table for connections. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>manual_pkfk</strong> (<em>dict</em>) – A dictionary containing manual primary key and foreign key relationships for specific databases.</p></li>
<li><p><strong>database</strong> (<em>str</em>) – The name of the database.</p></li>
<li><p><strong>repair_constraints</strong> (<em>bool</em>) – A flag indicating whether to repair constraints.</p></li>
<li><p><strong>single_starting_table</strong> (<em>bool</em>) – A flag indicating whether to use a single starting table for connections.</p></li>
<li><p><strong>edge_type_weights</strong> (<em>dict</em>) – A dictionary containing weights for different types of edges.</p></li>
<li><p><strong>vertex_colors</strong> (<em>dict</em>) – A dictionary containing colors for different types of vertices.</p></li>
<li><p><strong>pkfk_df</strong> (<em>pandas.DataFrame</em>) – A DataFrame containing primary key and foreign key relationships.</p></li>
<li><p><strong>orphan_tables</strong> (<em>list</em>) – A list of orphan tables.</p></li>
<li><p><strong>vertice_type_lookup</strong> (<em>dict</em>) – A dictionary for looking up vertex types.</p></li>
<li><p><strong>vertice_name_lookup</strong> (<em>dict</em>) – A dictionary for looking up vertex names.</p></li>
<li><p><strong>name_vertice_lookup</strong> (<em>dict</em>) – A dictionary for looking up vertex IDs by name.</p></li>
<li><p><strong>all_vertices</strong> (<em>list</em>) – A list of all vertices.</p></li>
<li><p><strong>edges</strong> (<em>list</em>) – A list of edges in the graph.</p></li>
<li><p><strong>edge_type_lookup</strong> (<em>dict</em>) – A dictionary for looking up edge types.</p></li>
<li><p><strong>edge_weight_lookup</strong> (<em>dict</em>) – A dictionary for looking up edge weights.</p></li>
<li><p><strong>schema_graph</strong> (<em>igraph.Graph</em>) – The schema graph.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph._construct_graph">
<span class="sig-name descname"><span class="pre">_construct_graph</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">igraph.Graph</span></span></span><a class="headerlink" href="#SchemaGraph._construct_graph" title="Link to this definition">¶</a></dt>
<dd><p>Constructs the schema graph.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The schema graph.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>igraph.Graph</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph._construct_pkfk_dataframe">
<span class="sig-name descname"><span class="pre">_construct_pkfk_dataframe</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.DataFrame</span></span></span><a class="headerlink" href="#SchemaGraph._construct_pkfk_dataframe" title="Link to this definition">¶</a></dt>
<dd><p>Constructs the primary key and foreign key DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The primary key and foreign key DataFrame.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph._construct_orphan_table_list">
<span class="sig-name descname"><span class="pre">_construct_orphan_table_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pkfk_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.DataFrame</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#SchemaGraph._construct_orphan_table_list" title="Link to this definition">¶</a></dt>
<dd><p>Constructs the list of orphan tables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pkfk_df</strong> (<em>pandas.DataFrame</em>) – The primary key and foreign key DataFrame. Defaults to None.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The list of orphan tables.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph._construct_vertice_lookup_dicts">
<span class="sig-name descname"><span class="pre">_construct_vertice_lookup_dicts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pkfk_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.DataFrame</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orphans</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#SchemaGraph._construct_vertice_lookup_dicts" title="Link to this definition">¶</a></dt>
<dd><p>Constructs dictionaries for vertex lookups.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pkfk_df</strong> (<em>pandas.DataFrame</em>) – The primary key and foreign key DataFrame. Defaults to None.</p></li>
<li><p><strong>orphans</strong> (<em>list</em>) – The list of orphan tables. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing vertex lookup dictionaries.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph._construct_edges">
<span class="sig-name descname"><span class="pre">_construct_edges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pkfk_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.DataFrame</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_vertices</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name_vertice_lookup</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vertice_name_lookup</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#SchemaGraph._construct_edges" title="Link to this definition">¶</a></dt>
<dd><p>Constructs the edges of the graph.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pkfk_df</strong> (<em>pandas.DataFrame</em>) – The primary key and foreign key DataFrame. Defaults to None.</p></li>
<li><p><strong>all_vertices</strong> (<em>list</em>) – The list of all vertices. Defaults to None.</p></li>
<li><p><strong>name_vertice_lookup</strong> (<em>dict</em>) – The dictionary for looking up vertex IDs by name. Defaults to None.</p></li>
<li><p><strong>vertice_name_lookup</strong> (<em>dict</em>) – The dictionary for looking up vertex names. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing edge data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph._repair_constraints">
<span class="sig-name descname"><span class="pre">_repair_constraints</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pkfk_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.DataFrame</span></span></span><a class="headerlink" href="#SchemaGraph._repair_constraints" title="Link to this definition">¶</a></dt>
<dd><p>Repairs constraints in the primary key and foreign key DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pkfk_df</strong> (<em>pandas.DataFrame</em>) – The primary key and foreign key DataFrame.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The repaired primary key and foreign key DataFrame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph.get_schema_identifiers_between_tables">
<span class="sig-name descname"><span class="pre">get_schema_identifiers_between_tables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#SchemaGraph.get_schema_identifiers_between_tables" title="Link to this definition">¶</a></dt>
<dd><p>Gets schema identifiers between tables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>table_names</strong> (<em>list</em>) – A list of table names.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary where keys are table names and values are lists of column names.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph.get_table_connections">
<span class="sig-name descname"><span class="pre">get_table_connections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#SchemaGraph.get_table_connections" title="Link to this definition">¶</a></dt>
<dd><p>Gets table connections.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>table_names</strong> (<em>list</em>) – A list of table names.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing connection information.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="SchemaGraph.get_connecting_vertices_and_edges">
<span class="sig-name descname"><span class="pre">get_connecting_vertices_and_edges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vertices</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_starting_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#SchemaGraph.get_connecting_vertices_and_edges" title="Link to this definition">¶</a></dt>
<dd><p>Gets connecting vertices and edges.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vertices</strong> (<em>list</em>) – A list of vertices.</p></li>
<li><p><strong>single_starting_table</strong> (<em>bool</em>) – Whether to use a single starting table. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing connecting vertices and edges.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/schema_linking_eval"></span><section id="schema-linking-eval">
<span id="id1"></span><h4>schema_linking_eval<a class="headerlink" href="#schema-linking-eval" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="compare_query_schema_elements">
<span class="sig-name descname"><span class="pre">compare_query_schema_elements</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predicted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#compare_query_schema_elements" title="Link to this definition">¶</a></dt>
<dd><p>Compares the schema elements (tables and columns) of two SQL queries and calculates precision, recall, and F1 score.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gold</strong> (<em>str</em>) – The gold standard SQL query.</p></li>
<li><p><strong>predicted</strong> (<em>str</em>) – The predicted SQL query.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – If True, prints detailed comparison results. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing matching, missing, and extra tables and columns, along with precision, recall, and F1 score.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mp_compare_query_schema_elements">
<span class="sig-name descname"><span class="pre">mp_compare_query_schema_elements</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q_nl_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pd.DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#mp_compare_query_schema_elements" title="Link to this definition">¶</a></dt>
<dd><p>Compares query schema elements in a DataFrame using multiprocessing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>q_nl_df</strong> (<em>pd.DataFrame</em>) – A DataFrame with ‘query_gold’, ‘query_predicted’, and ‘number’ columns.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary where keys are query numbers and values are comparison results.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="update_scores_in_existing_results">
<span class="sig-name descname"><span class="pre">update_scores_in_existing_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#update_scores_in_existing_results" title="Link to this definition">¶</a></dt>
<dd><p>Updates precision and F1 scores in an existing Excel file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – The path to the Excel file.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="compare_queries">
<span class="sig-name descname"><span class="pre">compare_queries</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#compare_queries" title="Link to this definition">¶</a></dt>
<dd><p>Compares two example SQL queries using <code class="docutils literal notranslate"><span class="pre">compare_query_schema_elements</span></code>.</p>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/schemarenamer"></span><section id="schemarenamer">
<span id="id1"></span><h4>schemarenamer<a class="headerlink" href="#schemarenamer" title="Link to this heading">¶</a></h4>
<dl class="py function" id="module-schemarenamer">
<dt class="sig sig-object py" id="schemarenamer.main">
<span class="sig-prename descclassname"><span class="pre">schemarenamer.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#schemarenamer.main" title="Link to this definition">¶</a></dt>
<dd><p>Executes the main logic of the script. This includes classifying the database schema, performing schema renaming, and saving the results to an Excel file.</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">no-index<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="schemarenamer.transform_score_df">
<span class="sig-prename descclassname"><span class="pre">schemarenamer.</span></span><span class="sig-name descname"><span class="pre">transform_score_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">score_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.DataFrame</span></span></span><a class="headerlink" href="#schemarenamer.transform_score_df" title="Link to this definition">¶</a></dt>
<dd><p>Transforms the input score DataFrame to combine table and column scores, lowercase identifiers, and remove duplicates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>score_df</strong> (<em>pandas.DataFrame</em>) – DataFrame containing table and column scores.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Transformed DataFrame with combined scores.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="schemarenamer.do_schema_renaming">
<span class="sig-prename descclassname"><span class="pre">schemarenamer.</span></span><span class="sig-name descname"><span class="pre">do_schema_renaming</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PacificIslandLandbirds'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score_lookup_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./data/gold-data/identifier-scores-evaluated-5-9-2024.xlsx'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuous_write</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ms</span> <span class="pre">sql'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_classifier_score_df</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">only_most_natural</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.DataFrame</span></span></span><a class="headerlink" href="#schemarenamer.do_schema_renaming" title="Link to this definition">¶</a></dt>
<dd><p>Renames schema identifiers (tables and columns) in a database based on human-evaluated naturalness scores.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database. Defaults to “PacificIslandLandbirds”.</p></li>
<li><p><strong>score_lookup_file</strong> (<em>str</em>) – Path to the Excel file containing human-evaluated scores. Defaults to “./data/gold-data/identifier-scores-evaluated-5-9-2024.xlsx”.</p></li>
<li><p><strong>continuous_write</strong> (<em>bool</em>) – If True, writes logs continuously. Defaults to False.</p></li>
<li><p><strong>db_type</strong> (<em>str</em>) – The type of the database (“ms sql” or “sqlite”). Defaults to “ms sql”.</p></li>
<li><p><strong>db_classifier_score_df</strong> (<em>pandas.DataFrame</em><em> or </em><em>None</em>) – DataFrame with classifier scores. If None, reads from score_lookup_file. Defaults to None.</p></li>
<li><p><strong>only_most_natural</strong> (<em>bool</em>) – If True, only generates the most natural identifier. Defaults to False.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – If True, prints progress information. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataFrame containing original and generated identifiers with scores and errors.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<p>:
.. py:function:: do_fewshot_identifier_transform(identifier, naturalness, data_dict_interpreter=None, only_most_natural=False, verbose=True, gpt_model=”gpt-4o”) -&gt; dict</p>
<blockquote>
<div><p>Transforms a given identifier to different naturalness levels using few-shot prompting and a data dictionary interpreter.</p>
<dl class="field-list simple">
<dt class="field-odd">param identifier<span class="colon">:</span></dt>
<dd class="field-odd"><p>The identifier to transform.</p>
</dd>
<dt class="field-even">type identifier<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
<dt class="field-odd">param naturalness<span class="colon">:</span></dt>
<dd class="field-odd"><p>The original naturalness level of the identifier (e.g., “N1”, “N2”, “N3”).</p>
</dd>
<dt class="field-even">type naturalness<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
<dt class="field-odd">param data_dict_interpreter<span class="colon">:</span></dt>
<dd class="field-odd"><p>An instance of DataDictInterpreter for retrieving natural identifiers. Defaults to None.</p>
</dd>
<dt class="field-even">type data_dict_interpreter<span class="colon">:</span></dt>
<dd class="field-even"><p>SNAILS_Artifacts.naturalness_modifier .data_dict_reader.DataDictInterpreter or None</p>
</dd>
<dt class="field-odd">param only_most_natural<span class="colon">:</span></dt>
<dd class="field-odd"><p>If True, only generates the most natural identifier. Defaults to False.</p>
</dd>
<dt class="field-even">type only_most_natural<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
<dt class="field-odd">param verbose<span class="colon">:</span></dt>
<dd class="field-odd"><p>If True, prints progress information. Defaults to True.</p>
</dd>
<dt class="field-even">type verbose<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
<dt class="field-odd">param gpt_model<span class="colon">:</span></dt>
<dd class="field-odd"><p>The GPT model to use. Defaults to “gpt-4o”.</p>
</dd>
<dt class="field-even">type gpt_model<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
<dt class="field-odd">return<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dictionary containing the transformed identifiers for different naturalness levels.</p>
</dd>
<dt class="field-even">rtype<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
<div class="toctree-wrapper compound">
</div>
</div></blockquote>
</section>
<span id="document-src/semantic_compare"></span><section id="semantic-compare">
<span id="id1"></span><h4>semantic_compare<a class="headerlink" href="#semantic-compare" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="record_evaluation">
<span class="sig-name descname"><span class="pre">record_evaluation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">result_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#record_evaluation" title="Link to this definition">¶</a></dt>
<dd><p>Updates the result DataFrame with the evaluation outcome.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>result_df</strong> (<em>pandas.DataFrame</em>) – DataFrame containing query results.</p></li>
<li><p><strong>query_id</strong> (<em>str</em>) – Identifier of the query being evaluated.</p></li>
<li><p><strong>result</strong> (<em>str</em>) – The evaluation result (“TRUE”, “FALSE”, or “UNDETERMINED”).</p></li>
<li><p><strong>message</strong> (<em>str</em>) – A message explaining the evaluation result.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The updated result DataFrame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="compare_gold_to_generated">
<span class="sig-name descname"><span class="pre">compare_gold_to_generated</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">generated</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">database_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ms-sql'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./local/db_info.json'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#compare_gold_to_generated" title="Link to this definition">¶</a></dt>
<dd><p>Compares gold standard and generated SQL queries for semantic equivalence.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gold</strong> (<em>str</em>) – The gold standard SQL query.</p></li>
<li><p><strong>generated</strong> (<em>str</em>) – The generated SQL query.</p></li>
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database to query.</p></li>
<li><p><strong>db_type</strong> (<em>str</em><em>, </em><em>optional</em>) – The type of the database (“ms-sql”, “sqlite”, or “tsql”).</p></li>
<li><p><strong>db_list_file</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the database connection information JSON file.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the equivalence result and reason.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="do_batch_compare">
<span class="sig-name descname"><span class="pre">do_batch_compare</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#do_batch_compare" title="Link to this definition">¶</a></dt>
<dd><p>Performs a batch comparison of generated SQL queries against gold standards.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database to query.</p></li>
<li><p><strong>result_file</strong> (<em>str</em>) – Path to the Excel file containing queries and results.</p></li>
</ul>
</dd>
</dl>
<div class="toctree-wrapper compound">
</div>
</dd></dl>

</section>
<span id="document-src/word_list_matching"></span><section id="word-list-matching">
<span id="id1"></span><h4>word_list_matching<a class="headerlink" href="#word-list-matching" title="Link to this heading">¶</a></h4>
<dl class="py function" id="module-word_list_matching">
<dt class="sig sig-object py" id="word_list_matching.debug_print">
<span class="sig-prename descclassname"><span class="pre">word_list_matching.</span></span><span class="sig-name descname"><span class="pre">debug_print</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doprint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.debug_print" title="Link to this definition">¶</a></dt>
<dd><p>Prints arguments if the debug flag is set and doprint is True.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – Variable length argument list.</p></li>
<li><p><strong>doprint</strong> (<em>bool</em>) – Boolean flag to control printing.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>TypeError</strong> – if doprint is not a boolean.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="word_list_matching.main">
<span class="sig-prename descclassname"><span class="pre">word_list_matching.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.main" title="Link to this definition">¶</a></dt>
<dd><p>Main function to interact with the user and calculate naturalness.</p>
<p>Gets user input, tokenizes it, evaluates naturalness, and exports results.</p>
<dl class="field-list simple">
<dt class="field-odd">No-index<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">word_list_matching.</span></span><span class="sig-name descname"><span class="pre">NaturalnessCalculator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wordlist_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./data/words/words'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excel_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the naturalness of words and identifiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wordlist_file</strong> (<em>str</em>) – Path to the word list file.</p></li>
<li><p><strong>excel_file</strong> (<em>str</em><em> or </em><em>None</em>) – Path to the Excel file containing pre-calculated word vectors.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.score_result">
<span class="sig-name descname"><span class="pre">score_result</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_match_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.score_result" title="Link to this definition">¶</a></dt>
<dd><p>Calculates a score based on edit distance and ambiguity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>best_match_dict</strong> (<em>dict</em>) – Dictionary containing best match information.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The calculated score.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.assign_label_from_score">
<span class="sig-name descname"><span class="pre">assign_label_from_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.assign_label_from_score" title="Link to this definition">¶</a></dt>
<dd><p>Assigns a naturalness label based on the score.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>score</strong> (<em>float</em>) – The calculated naturalness score.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The naturalness label (N1, N2, or N3).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.tokenize_identifier">
<span class="sig-name descname"><span class="pre">tokenize_identifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifier</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camel_case</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.tokenize_identifier" title="Link to this definition">¶</a></dt>
<dd><p>Tokenizes an identifier string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier</strong> (<em>str</em>) – The identifier string.</p></li>
<li><p><strong>camel_case</strong> (<em>bool</em>) – Whether to split on camel case.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of tokens.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.get_best_match">
<span class="sig-name descname"><span class="pre">get_best_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">token</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.get_best_match" title="Link to this definition">¶</a></dt>
<dd><p>Retrieves the best match for a token.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>token</strong> (<em>str</em><em> or </em><em>None</em>) – The token to find the best match for.</p></li>
<li><p><strong>result_dict</strong> (<em>dict</em><em> or </em><em>None</em>) – The result dictionary from evaluate_naturalness.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the best match information.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – if neither token nor result_dict is provided.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.calculate_score_and_distance_of_delim_and_composite">
<span class="sig-name descname"><span class="pre">calculate_score_and_distance_of_delim_and_composite</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifier</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.calculate_score_and_distance_of_delim_and_composite" title="Link to this definition">¶</a></dt>
<dd><p>Calculates score and distance for delimited and composite identifiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>identifier</strong> (<em>str</em>) – The identifier string.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing a list of words and a dictionary of scores.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[list, dict]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator._mp_batch_function">
<span class="sig-name descname"><span class="pre">_mp_batch_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifier_sublist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mp_result_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_ix</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator._mp_batch_function" title="Link to this definition">¶</a></dt>
<dd><p>Batch function for multiprocessing score calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier_sublist</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – A sublist of identifiers.</p></li>
<li><p><strong>mp_result_dict</strong> (<em>dict</em>) – A shared dictionary to store results.</p></li>
<li><p><strong>p_ix</strong> (<em>int</em>) – The process index.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.mp_calculate_score_and_distance_of_delim_and_composite">
<span class="sig-name descname"><span class="pre">mp_calculate_score_and_distance_of_delim_and_composite</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifier_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_processes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.mp_calculate_score_and_distance_of_delim_and_composite" title="Link to this definition">¶</a></dt>
<dd><p>Calculates scores and distances using multiprocessing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier_list</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – A list of identifiers.</p></li>
<li><p><strong>num_processes</strong> (<em>int</em>) – The number of processes to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of identifiers.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.get_min_distance_for_single_word">
<span class="sig-name descname"><span class="pre">get_min_distance_for_single_word</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.get_min_distance_for_single_word" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the minimum edit distance for a single word.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>word</strong> (<em>str</em>) – The word to calculate the distance for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The minimum edit distance.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.distance_batch_function">
<span class="sig-name descname"><span class="pre">distance_batch_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word_sublist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mp_result_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.distance_batch_function" title="Link to this definition">¶</a></dt>
<dd><p>Batch function for multiprocessing distance calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>word_sublist</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – A sublist of words.</p></li>
<li><p><strong>mp_result_dict</strong> (<em>dict</em>) – A shared dictionary to store results.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.mp_get_min_distance_for_word_list">
<span class="sig-name descname"><span class="pre">mp_get_min_distance_for_word_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_processes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.mp_get_min_distance_for_word_list" title="Link to this definition">¶</a></dt>
<dd><p>Calculates minimum distances for a word list using multiprocessing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>word_list</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – A list of words.</p></li>
<li><p><strong>num_processes</strong> (<em>int</em>) – The number of processes to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary of minimum distances for each word.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.find_most_natural_in_composite">
<span class="sig-name descname"><span class="pre">find_most_natural_in_composite</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifier</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_score</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reparse_distance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_word_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.find_most_natural_in_composite" title="Link to this definition">¶</a></dt>
<dd><p>Finds the most natural words in a composite identifier.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier</strong> (<em>str</em>) – The identifier string.</p></li>
<li><p><strong>best_score</strong> (<em>int</em>) – The best score found so far.</p></li>
<li><p><strong>word_list</strong> (<em>list</em><em> or </em><em>None</em>) – A list to store the most natural words.</p></li>
<li><p><strong>score_dict</strong> (<em>dict</em><em> or </em><em>None</em>) – A dictionary to store scores for each word.</p></li>
<li><p><strong>reparse_distance</strong> (<em>int</em>) – The distance threshold for reparsing.</p></li>
<li><p><strong>min_word_len</strong> (<em>int</em>) – The minimum word length to consider.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the word list and score dictionary.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[list, dict]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.evaluate_naturalness">
<span class="sig-name descname"><span class="pre">evaluate_naturalness</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.evaluate_naturalness" title="Link to this definition">¶</a></dt>
<dd><p>Evaluates the naturalness of a word.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>word</strong> (<em>str</em>) – The word to evaluate.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing naturalness information.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.iterate_possible_words">
<span class="sig-name descname"><span class="pre">iterate_possible_words</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">abbreviation</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.iterate_possible_words" title="Link to this definition">¶</a></dt>
<dd><p>Generates possible word pairs from an abbreviation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>abbreviation</strong> (<em>str</em>) – The abbreviation string.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of word pairs.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[tuple[str, str]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.get_levenshstein_dist_dict">
<span class="sig-name descname"><span class="pre">get_levenshstein_dist_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word_df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.get_levenshstein_dist_dict" title="Link to this definition">¶</a></dt>
<dd><p>Calculates Levenshtein distances between a word and a DataFrame of words.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>word</strong> (<em>str</em>) – The word to calculate distances from.</p></li>
<li><p><strong>word_df</strong> (<em>pd.DataFrame</em>) – The DataFrame of words.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing a dictionary of distances and a dictionary of statistics.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[dict, dict]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.compare_letter_order">
<span class="sig-name descname"><span class="pre">compare_letter_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">short_word</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long_word</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_letter_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.compare_letter_order" title="Link to this definition">¶</a></dt>
<dd><p>Compares the letter order of two words.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>short_word</strong> (<em>str</em>) – The shorter word.</p></li>
<li><p><strong>long_word</strong> (<em>str</em>) – The longer word.</p></li>
<li><p><strong>first_letter_match</strong> (<em>bool</em>) – Whether the first letters must match.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the letters are in order, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.get_words_with_letters_in_order">
<span class="sig-name descname"><span class="pre">get_words_with_letters_in_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word_df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.get_words_with_letters_in_order" title="Link to this definition">¶</a></dt>
<dd><p>Filters a DataFrame for words with letters in the same order as the given word.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>word</strong> (<em>str</em>) – The word to compare against.</p></li>
<li><p><strong>word_df</strong> (<em>pd.DataFrame</em>) – The DataFrame of words.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A filtered DataFrame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.get_words_with_same_letters">
<span class="sig-name descname"><span class="pre">get_words_with_same_letters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">word_df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.get_words_with_same_letters" title="Link to this definition">¶</a></dt>
<dd><p>Filters a DataFrame for words with the same letters as the given word.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>word</strong> (<em>str</em>) – The word to compare against.</p></li>
<li><p><strong>word_df</strong> (<em>pd.DataFrame</em>) – The DataFrame of words.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A filtered DataFrame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.create_word_letter_freq_vectors">
<span class="sig-name descname"><span class="pre">create_word_letter_freq_vectors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./words/words'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_word_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.create_word_letter_freq_vectors" title="Link to this definition">¶</a></dt>
<dd><p>Creates word letter frequency vectors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – The path to the word list file.</p></li>
<li><p><strong>min_word_length</strong> (<em>int</em>) – The minimum word length to consider.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame containing word letter frequency vectors.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.default_value">
<span class="sig-name descname"><span class="pre">default_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.default_value" title="Link to this definition">¶</a></dt>
<dd><p>Returns the default value for dictionaries (0).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>0</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="word_list_matching.NaturalnessCalculator.default_value_list">
<span class="sig-name descname"><span class="pre">default_value_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#word_list_matching.NaturalnessCalculator.default_value_list" title="Link to this definition">¶</a></dt>
<dd><p>Returns the default value for dictionaries (empty list).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>[]</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/util"></span><section id="util">
<span id="id1"></span><h4>util<a class="headerlink" href="#util" title="Link to this heading">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-src/util/call_google_nl"></span><section id="call-google-nl">
<span id="id1"></span><h5>call_google_nl<a class="headerlink" href="#call-google-nl" title="Link to this heading">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="call_vertex">
<span class="sig-name descname"><span class="pre">call_vertex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'gemini-1.5-pro-latest'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#call_vertex" title="Link to this definition">¶</a></dt>
<dd><p>Calls the Vertex AI Gemini model with the given prompt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>) – The input prompt for the LLM.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The name of the Gemini model to use. Defaults to “gemini-1.5-pro-latest”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The LLM’s response text.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>generation_types.StopCandidateException</strong> – If the LLM encounters a stop sequence.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="call_google_palm">
<span class="sig-name descname"><span class="pre">call_google_palm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_attempts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'text-bison'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_tokens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">800</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#call_google_palm" title="Link to this definition">¶</a></dt>
<dd><p>Calls the Google PaLM API with the given prompt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>) – The input prompt for the LLM.</p></li>
<li><p><strong>max_attempts</strong> (<em>int</em><em>, </em><em>optional</em>) – The maximum number of attempts to make. Defaults to 10.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The name of the PaLM model to use. Defaults to ‘text-bison’.</p></li>
<li><p><strong>max_tokens</strong> (<em>int</em><em>, </em><em>optional</em>) – The maximum number of tokens to generate. Defaults to 800.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to print verbose output. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The LLM’s response text.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="call_codey">
<span class="sig-name descname"><span class="pre">call_codey</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_attempts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'code-bison-32k'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_tokens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">800</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#call_codey" title="Link to this definition">¶</a></dt>
<dd><p>Calls the Codey API (Vertex AI Code Generation) with the given prompt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>) – The input prompt for the LLM.</p></li>
<li><p><strong>max_attempts</strong> (<em>int</em><em>, </em><em>optional</em>) – The maximum number of attempts to make. Defaults to 10.</p></li>
<li><p><strong>model</strong> (<em>str</em><em>, </em><em>optional</em>) – The name of the Codey model to use. Defaults to ‘code-bison-32k’.</p></li>
<li><p><strong>max_tokens</strong> (<em>int</em><em>, </em><em>optional</em>) – The maximum number of tokens to generate. Defaults to 800.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to print verbose output. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The LLM’s response text.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/call_llama"></span><section id="call-llama">
<span id="id1"></span><h5>call_llama<a class="headerlink" href="#call-llama" title="Link to this heading">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="call_code_llama">
<span class="sig-name descname"><span class="pre">call_code_llama</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#call_code_llama" title="Link to this definition">¶</a></dt>
<dd><p>Call a Code Llama API to generate SQL queries.
API is hosted on AWS EC2 instance using VLLM.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>prompt</strong> (<em>str</em>) – Prompt to generate SQL query from.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p>HTTPError if the API request fails.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Generated SQL query or “Error” if the API call fails.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="codellama.json">
<span class="sig-prename descclassname"><span class="pre">codellama.</span></span><span class="sig-name descname"><span class="pre">json</span></span><a class="headerlink" href="#codellama.json" title="Link to this definition">¶</a></dt>
<dd><p>Configuration file for the Code Llama API parameters.  This file should be a JSON file containing the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_tokens</span></code>: Maximum number of tokens to generate. (int)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">temperature</span></code>: Sampling temperature. (float)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">top_p</span></code>: Top-p sampling parameter. (float)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code>: Number of sequences to generate. (int)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frequency_penalty</span></code>: Frequency penalty. (float)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">presence_penalty</span></code>: Presence penalty. (float)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_url</span></code>: URL of the Code Llama API endpoint. (str)</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;max_tokens&quot;</span><span class="p">:</span> <span class="mi">2048</span><span class="p">,</span>
  <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;frequency_penalty&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;presence_penalty&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;aws_url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://&lt;public IPv4 address&gt;:8000/generate&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/callgpt"></span><section id="callgpt">
<span id="id1"></span><h5>callgpt<a class="headerlink" href="#callgpt" title="Link to this heading">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="call_gpt">
<span class="sig-name descname"><span class="pre">call_gpt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_attempts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gpt-3.5-turbo-16k'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_tokens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delay_seconds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#call_gpt" title="Link to this definition">¶</a></dt>
<dd><p>Calls the OpenAI GPT API with the given prompt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>) – The prompt to send to the GPT API.</p></li>
<li><p><strong>max_attempts</strong> (<em>int</em>) – The maximum number of attempts to make if the API call fails. Defaults to 10.</p></li>
<li><p><strong>model</strong> (<em>str</em>) – The GPT model to use. Defaults to “gpt-3.5-turbo-16k”.</p></li>
<li><p><strong>max_tokens</strong> (<em>int</em><em> or </em><em>None</em>) – The maximum number of tokens to generate. If None, uses the value from the ‘.local/openai.json’ file.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Whether to print the GPT response. Defaults to True.</p></li>
<li><p><strong>delay_seconds</strong> (<em>int</em>) – The number of seconds to wait between attempts. Defaults to 2.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The GPT response.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – If the API call fails after the maximum number of attempts.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="get_decoded_token_list">
<span class="sig-name descname"><span class="pre">get_decoded_token_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gpt-3.5-turbo-16k'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#get_decoded_token_list" title="Link to this definition">¶</a></dt>
<dd><p>Encodes the given input string into tokens using the specified model’s encoding and then decodes each token back to a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>str</em>) – The input string to encode.</p></li>
<li><p><strong>model</strong> (<em>str</em>) – The name of the model whose encoding should be used. Defaults to “gpt-3.5-turbo-16k”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of decoded tokens.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/calltogetherai"></span><section id="calltogetherai">
<span id="id1"></span><h5>calltogetherai<a class="headerlink" href="#calltogetherai" title="Link to this heading">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="call_togetherai">
<span class="sig-name descname"><span class="pre">call_togetherai</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#call_togetherai" title="Link to this definition">¶</a></dt>
<dd><p>Calls the Together.ai API to generate a response to a given prompt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>) – The prompt to send to the API.</p></li>
<li><p><strong>model</strong> (<em>str</em>) – The name of the model to use.  Should be one of the keys in the <code class="docutils literal notranslate"><span class="pre">model_lookup_dict</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The generated response content.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>FileNotFoundError</strong> – If the “.local/togetherai.json” file is not found.</p></li>
<li><p><strong>json.JSONDecodeError</strong> – If the “.local/togetherai.json” file contains invalid JSON.</p></li>
<li><p><strong>Exception</strong> – If there is an error communicating with the Together.ai API or processing the response.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/db_util"></span><section id="db-util">
<span id="id1"></span><h5>db_util<a class="headerlink" href="#db-util" title="Link to this heading">¶</a></h5>
<dl class="py function" id="module-db_util">
<dt class="sig sig-object py" id="db_util.do_query">
<span class="sig-prename descclassname"><span class="pre">db_util.</span></span><span class="sig-name descname"><span class="pre">do_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_bytes_to_str</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.local/dbinfo.json'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pd.DataFrame</span></span></span><a class="headerlink" href="#db_util.do_query" title="Link to this definition">¶</a></dt>
<dd><p>Executes a SQL query on a specified database and returns the result as a pandas DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>str</em>) – The SQL query to execute.</p></li>
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database to connect to.</p></li>
<li><p><strong>debug</strong> (<em>bool</em>) – If True, prints debug information. Defaults to False.</p></li>
<li><p><strong>convert_bytes_to_str</strong> (<em>bool</em>) – If True, converts byte values to strings using cp437 encoding. Defaults to False.</p></li>
<li><p><strong>db_list_file</strong> (<em>str</em>) – The path to the database list file. Defaults to “.local/dbinfo.json”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame containing the query results. If the query returns no results, an empty DataFrame is returned.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util.connect_to_db">
<span class="sig-prename descclassname"><span class="pre">db_util.</span></span><span class="sig-name descname"><span class="pre">connect_to_db</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.local/dbinfo.json'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pyodbc.Connection</span></span></span><a class="headerlink" href="#db_util.connect_to_db" title="Link to this definition">¶</a></dt>
<dd><p>Establishes a connection to the specified database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database to connect to.</p></li>
<li><p><strong>db_list_file</strong> (<em>str</em>) – The path to the JSON file containing database connection information. Defaults to ‘.local/dbinfo.json’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A connection object to the specified database.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pyodbc.Connection</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>FileNotFoundError</strong> – If the db_list_file does not exist.</p></li>
<li><p><strong>KeyError</strong> – If the database information is not found in the db_list_file.</p></li>
<li><p><strong>pyodbc.Error</strong> – If there is an error connecting to the database.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util.get_tables_and_columns_from_sql_server_db">
<span class="sig-prename descclassname"><span class="pre">db_util.</span></span><span class="sig-name descname"><span class="pre">get_tables_and_columns_from_sql_server_db</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append_col_types</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uppercase</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'dbo'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#db_util.get_tables_and_columns_from_sql_server_db" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dictionary of tables and columns from a SQL Server database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_name</strong> (<em>str</em>) – The name of the database to use for the schema.</p></li>
<li><p><strong>append_col_types</strong> (<em>bool</em>) – Whether to append the column types to the column names. Defaults to True.</p></li>
<li><p><strong>table_list</strong> (<em>list</em><em> or </em><em>None</em>) – A list of tables to limit the request to. Defaults to None.</p></li>
<li><p><strong>uppercase</strong> (<em>bool</em>) – Whether to return table and column names in uppercase. Defaults to False.</p></li>
<li><p><strong>schema</strong> (<em>str</em>) – The database schema to query. Defaults to “dbo”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary where keys are table names and values are lists of column names.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util.get_tables_and_columns_df">
<span class="sig-prename descclassname"><span class="pre">db_util.</span></span><span class="sig-name descname"><span class="pre">get_tables_and_columns_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tables_and_col_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pd.DataFrame</span></span></span><a class="headerlink" href="#db_util.get_tables_and_columns_df" title="Link to this definition">¶</a></dt>
<dd><p>Converts a dictionary of tables and their columns into a pandas DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tables_and_col_dict</strong> (<em>dict</em>) – A dictionary where keys are table names and values are lists of column names.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame with two columns: ‘table’ and ‘column’.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util.make_db_schema_prompt">
<span class="sig-prename descclassname"><span class="pre">db_util.</span></span><span class="sig-name descname"><span class="pre">make_db_schema_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'MS</span> <span class="pre">SQL</span> <span class="pre">Server'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'query'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifier_tags</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'dbo'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_col_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">get_tables_and_columns_from_sql_server_db</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_util.make_db_schema_prompt" title="Link to this definition">¶</a></dt>
<dd><p>Creates a zero-shot prompt with schema knowledge for an LLM query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_name</strong> (<em>str</em>) – The name of the database to use for the schema.</p></li>
<li><p><strong>db_type</strong> (<em>str</em>) – The type of database. Defaults to ‘MS SQL Server’.</p></li>
<li><p><strong>task</strong> (<em>str</em>) – The task to be performed (‘query’ or ‘tables’). Defaults to ‘query’.</p></li>
<li><p><strong>table_list</strong> (<em>list</em><em> or </em><em>None</em>) – A list of tables to include in the prompt. Defaults to None.</p></li>
<li><p><strong>column_list</strong> (<em>list</em><em> or </em><em>None</em>) – A list of columns to include in the prompt. Defaults to None.</p></li>
<li><p><strong>identifier_tags</strong> (<em>bool</em>) – Whether to include tags around table and column names. Defaults to False.</p></li>
<li><p><strong>schema</strong> (<em>str</em>) – The database schema to query. Defaults to “dbo”.</p></li>
<li><p><strong>table_col_function</strong> (<em>function</em>) – The function to use for retrieving table and column information. Defaults to <a class="reference internal" href="#db_util.get_tables_and_columns_from_sql_server_db" title="db_util.get_tables_and_columns_from_sql_server_db"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_tables_and_columns_from_sql_server_db()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The prompt to be used for the LLM query.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util.get_table_cardinality">
<span class="sig-prename descclassname"><span class="pre">db_util.</span></span><span class="sig-name descname"><span class="pre">get_table_cardinality</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#db_util.get_table_cardinality" title="Link to this definition">¶</a></dt>
<dd><p>Retrieves the number of rows in a specified table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_name</strong> (<em>str</em>) – The name of the database.</p></li>
<li><p><strong>table_name</strong> (<em>str</em>) – The name of the table.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The number of rows in the table.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util.get_db_tables_cardinality">
<span class="sig-prename descclassname"><span class="pre">db_util.</span></span><span class="sig-name descname"><span class="pre">get_db_tables_cardinality</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_to_temp_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pd.DataFrame</span></span></span><a class="headerlink" href="#db_util.get_db_tables_cardinality" title="Link to this definition">¶</a></dt>
<dd><p>Retrieves the cardinality for each table in the specified database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_name</strong> (<em>str</em>) – The name of the database.</p></li>
<li><p><strong>save_to_temp_folder</strong> (<em>bool</em>) – If True, saves the resulting DataFrame to a CSV file. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame containing table names and their cardinalities.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – If there is an error retrieving the cardinality for a table.</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/db_util_sqlite"></span><section id="db-util-sqlite">
<span id="id1"></span><h5>db_util_sqlite<a class="headerlink" href="#db-util-sqlite" title="Link to this heading">¶</a></h5>
<dl class="py function" id="module-db_util_sqlite">
<dt class="sig sig-object py" id="db_util_sqlite.do_query">
<span class="sig-prename descclassname"><span class="pre">db_util_sqlite.</span></span><span class="sig-name descname"><span class="pre">do_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.local/spider_dbinfo.json'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.DataFrame</span></span></span><a class="headerlink" href="#db_util_sqlite.do_query" title="Link to this definition">¶</a></dt>
<dd><p>Executes a SQL query against a SQLite database and returns the result as a Pandas DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>str</em>) – The SQL query to execute.</p></li>
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database to query.</p></li>
<li><p><strong>db_list_file</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the JSON file containing database connection information. Defaults to “.local/spider_dbinfo.json”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The query result as a Pandas DataFrame, or an empty DataFrame if the query returns no results.  Returns None if a ValueError occurs during DataFrame creation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame or None</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – If the specified database is not found in the <cite>db_list_file</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util_sqlite.connect_to_db">
<span class="sig-prename descclassname"><span class="pre">db_util_sqlite.</span></span><span class="sig-name descname"><span class="pre">connect_to_db</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">database_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.local/spider_dbinfo.json'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">sqlite3.Connection</span></span></span><a class="headerlink" href="#db_util_sqlite.connect_to_db" title="Link to this definition">¶</a></dt>
<dd><p>Establishes a connection to a SQLite database based on information provided in a JSON file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_name</strong> (<em>str</em>) – The name of the database to connect to.</p></li>
<li><p><strong>db_list_file</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the JSON file containing database connection information. Defaults to “.local/spider_dbinfo.json”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A connection object to the SQLite database.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>sqlite3.Connection</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – If the specified database is not found in the <cite>db_list_file</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util_sqlite.get_tables_and_columns_from_sqlite_db">
<span class="sig-prename descclassname"><span class="pre">db_util_sqlite.</span></span><span class="sig-name descname"><span class="pre">get_tables_and_columns_from_sqlite_db</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append_col_types</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uppercase</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_list_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.local/spider_dbinfo.json'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_util_sqlite.get_tables_and_columns_from_sqlite_db" title="Link to this definition">¶</a></dt>
<dd><p>Retrieves table and column information from a SQLite database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_name</strong> (<em>str</em>) – The name of the database.</p></li>
<li><p><strong>append_col_types</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to append column types to column names. Defaults to True.</p></li>
<li><p><strong>table_list</strong> (<em>list</em><em>, </em><em>optional</em>) – Optional list of tables to retrieve information for. If None, retrieves information for all tables.</p></li>
<li><p><strong>uppercase</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, converts table and column names to uppercase. Defaults to False.</p></li>
<li><p><strong>schema</strong> (<em>str</em><em>, </em><em>optional</em>) – Optional schema name. Not used for SQLite. Defaults to “”.</p></li>
<li><p><strong>db_list_file</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the JSON file containing database connection information. Defaults to “.local/spider_dbinfo.json”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary where keys are table names and values are lists of column names (optionally with types appended).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util_sqlite.make_db_schema_prompt">
<span class="sig-prename descclassname"><span class="pre">db_util_sqlite.</span></span><span class="sig-name descname"><span class="pre">make_db_schema_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sqlite'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'query'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifier_tags</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_natural_schema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_util_sqlite.make_db_schema_prompt" title="Link to this definition">¶</a></dt>
<dd><p>Constructs a database schema prompt for use with other tools.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_name</strong> – The name of the database.</p></li>
<li><p><strong>db_type</strong> – The type of the database (‘sqlite’).</p></li>
<li><p><strong>task</strong> – The task for which the prompt is being generated (‘query’ or ‘tables’).</p></li>
<li><p><strong>table_list</strong> – A list of table names.</p></li>
<li><p><strong>column_list</strong> – A list of column names.</p></li>
<li><p><strong>identifier_tags</strong> – Whether to include identifier tags.</p></li>
<li><p><strong>use_natural_schema</strong> – Whether to use a natural schema.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The generated database schema prompt.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="db_util_sqlite.get_tables_and_columns_df">
<span class="sig-prename descclassname"><span class="pre">db_util_sqlite.</span></span><span class="sig-name descname"><span class="pre">get_tables_and_columns_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tables_and_col_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#db_util_sqlite.get_tables_and_columns_df" title="Link to this definition">¶</a></dt>
<dd><p>Converts a dictionary of table and column information into a Pandas DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tables_and_col_dict</strong> – A dictionary where keys are table names and values are lists of column names.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A Pandas DataFrame representing the table and column information.</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/load_consolidated_results"></span><section id="load-consolidated-results">
<span id="id1"></span><h5>load_consolidated_results<a class="headerlink" href="#load-consolidated-results" title="Link to this heading">¶</a></h5>
<dl class="py class">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ConsolidatedResultsLoader</span></span><a class="headerlink" href="#ConsolidatedResultsLoader" title="Link to this definition">¶</a></dt>
<dd><p>Class for loading and storing the consolidated results of the NL-to-SQL annotation files
and other analysis outputs such as token analysis and query statistics</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.config_dict">
<span class="sig-name descname"><span class="pre">config_dict</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">dict</span></em><a class="headerlink" href="#ConsolidatedResultsLoader.config_dict" title="Link to this definition">¶</a></dt>
<dd><p>Dictionary containing the configuration parameters for the analysis</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.get_joined_dataframes">
<span class="sig-name descname"><span class="pre">get_joined_dataframes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jointype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'left'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.get_joined_dataframes" title="Link to this definition">¶</a></dt>
<dd><p>Joins all of the dataframes into a single dataframe. The join condition is a composite of model, database name, naturalness level, and question number</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>jointype</strong> (<em>str</em>) – Type of join to perform. Defaults to left join.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Joined dataframe.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.load_prompt_tokens">
<span class="sig-name descname"><span class="pre">load_prompt_tokens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./data/tokenizer_analysis/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.load_prompt_tokens" title="Link to this definition">¶</a></dt>
<dd><p>Load the token analysis data generated by the tokenizer_analysis.ipynb workbook
The file contains all question prompts and their tokenizations generated
by each model used in the experiments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_directory</strong> (<em>str</em>) – Directory where the files are stored.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pandas Dataframe containing all of the prompt token files</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.load_sentence_level_similarities">
<span class="sig-name descname"><span class="pre">load_sentence_level_similarities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./data/tokenizer_analysis/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.load_sentence_level_similarities" title="Link to this definition">¶</a></dt>
<dd><p>Load the sentence level embedding similarity comparisons generated by the tokenizer_analysis.ipynb workbook
Scores are based on cosine similarity (distance) between the semantic embeddings (SentenceTransformers)
generated for a NL question and a corresponding gold query for each naturalness level.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_directory</strong> (<em>str</em>) – Directory where the files are stored.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pandas Dataframe containing all of the question-query similarity scores for each naturalness level</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.load_world_level_similarities">
<span class="sig-name descname"><span class="pre">load_world_level_similarities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./data/tokenizer_analysis/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.load_world_level_similarities" title="Link to this definition">¶</a></dt>
<dd><p>Load the word - identifier level embedding similarity comparisons generated by the tokenizer_analysis.ipynb workbook.
scores are based on the highest cosine similarity distance between a schema identifier and a word in the
natural language question.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_directory</strong> (<em>str</em>) – Directory where the files are stored.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pandas Dataframe containing all of the identifier-word similarity scores for each naturalness level</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.load_identifier_token_analysis_files">
<span class="sig-name descname"><span class="pre">load_identifier_token_analysis_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./data/tokenizer_analysis/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.load_identifier_token_analysis_files" title="Link to this definition">¶</a></dt>
<dd><p>Load the token analysis data generated by the tokenizer_analysis.ipynb workbook
The file contains all database identifiers and their tokenizations generated
by each model used in the experiments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_directory</strong> (<em>str</em>) – Directory where the files are stored.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pandas Dataframe containing all of the token files</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.load_question_token_analysis_files">
<span class="sig-name descname"><span class="pre">load_question_token_analysis_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./data/tokenizer_analysis/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.load_question_token_analysis_files" title="Link to this definition">¶</a></dt>
<dd><p>Load the token analysis data generated by the tokenizer_analysis.ipynb workbook</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_directory</strong> (<em>str</em>) – Directory where the files are stored.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pandas Dataframe containing all of the token files</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.load_query_token_character_ratio_file">
<span class="sig-name descname"><span class="pre">load_query_token_character_ratio_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./data/tokenizer_analysis'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.load_query_token_character_ratio_file" title="Link to this definition">¶</a></dt>
<dd><p>Load query-level mean token:char ratios generated by the tokenizer_analysis.ipynb workbook</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_directory</strong> (<em>str</em>) – Directory where the files are stored.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pandas Dataframe containing all of the ratio means at the question-query pair level</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.load_annotation_files">
<span class="sig-name descname"><span class="pre">load_annotation_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">annotation_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_error_columns</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.load_annotation_files" title="Link to this definition">¶</a></dt>
<dd><p>Load all of the human-validated NL-to-SQL annotation files into a single dataframe</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>annotation_directory</strong> (<em>str</em><em> or </em><em>None</em>) – Directory where the annotation files are stored</p></li>
<li><p><strong>database</strong> (<em>str</em><em> or </em><em>None</em>) – Name of the database to filter by. If None, all databases will be loaded</p></li>
<li><p><strong>remove_error_columns</strong> (<em>bool</em>) – Option to exclude error classification data from annotations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pandas Dataframe containing all of the annotation files</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ConsolidatedResultsLoader.load_identifier_crosswalks">
<span class="sig-name descname"><span class="pre">load_identifier_crosswalks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./db/schema-xwalks/consolidated_and_validated'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">SBODemo_full</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ConsolidatedResultsLoader.load_identifier_crosswalks" title="Link to this definition">¶</a></dt>
<dd><p>Load a single dataframe containing identifier naturalness crosswalk data from all databases</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_directory</strong> (<em>str</em>) – Directory where the files are stored.</p></li>
<li><p><strong>SBODemo_full</strong> (<em>bool</em>) – Use crosswalk containing ALL SBODemo identifiers (as opposed to the benchmark subset)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A single dataframe containing identifier naturalness crosswalk data from all databases</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="export_gold_data">
<span class="sig-name descname"><span class="pre">export_gold_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#export_gold_data" title="Link to this definition">¶</a></dt>
<dd><p>Exports gold data to an Excel file.</p>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/load_nl_questions"></span><section id="load-nl-questions">
<span id="id1"></span><h5>load_nl_questions<a class="headerlink" href="#load-nl-questions" title="Link to this heading">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="load_nlq_into_df">
<span class="sig-name descname"><span class="pre">load_nlq_into_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filepath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'./db/queries/'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.DataFrame</span></span></span><a class="headerlink" href="#load_nlq_into_df" title="Link to this definition">¶</a></dt>
<dd><p>Load natural language questions from a file into a pandas DataFrame.</p>
<p>The function reads a file containing natural language questions and SQL query pairs and their associated metadata, processes the content, and returns a pandas DataFrame.  If the file specified by <code class="docutils literal notranslate"><span class="pre">filename</span></code> is not found in <code class="docutils literal notranslate"><span class="pre">filepath</span></code>, the function attempts to unzip “SNAILS_Gold_Queries.zip” in the <code class="docutils literal notranslate"><span class="pre">filepath</span></code> directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – The name of the file containing the questions.</p></li>
<li><p><strong>filepath</strong> (<em>str</em>) – The path to the directory containing the file.</p></li>
</ul>
</dd>
<dt class="field-even">Default filepath<span class="colon">:</span></dt>
<dd class="field-even"><p>“./db/queries/”</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>FileNotFoundError</strong> – If the specified file is not found after attempting to unzip.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame containing the processed questions and their metadata.  Columns include “number”, “question”, “hints”, “notes”, and “query_gold”.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
<span id="document-src/util/tokenprocessing"></span><section id="tokenprocessing">
<span id="id1"></span><h5>tokenprocessing<a class="headerlink" href="#tokenprocessing" title="Link to this heading">¶</a></h5>
<dl class="py function">
<dt class="sig sig-object py" id="make_token_tag">
<span class="sig-name descname"><span class="pre">make_token_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#make_token_tag" title="Link to this definition">¶</a></dt>
<dd><p>Feature engineering for identifiers, tags each character as a vowel, consonant, number, special character, or other.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>identifier</strong> (<em>str</em>) – The identifier to tag.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A string of tag characters the same length as the input string.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">SNAILS</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-usage/installation">Installing SNAILS</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-artifacts/artifacts">SNAILS artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-natural_views/natural_views">Natural Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-reproducibility/reproducibility">Reproducing SNAILS Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-src/src">src</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Kyle Luoma.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>